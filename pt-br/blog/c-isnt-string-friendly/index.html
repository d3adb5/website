<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Há uma década, se vocẽ me pedisse para falar sobre programação, eu, jovem e
inexperiente, provavelmente diria que todo mundo deveria programar em C, para
que todos os programas pudessem ter alta performance e que programadores que
reclamavam da linguagem eram preguiçosos demais para lidar com alocação de
memória e ponteiros. Que vergonha!
Tenho certeza que eu atribuía qualquer lentidão ou delay a desenvolvedores
Java preguiçosos:

Vou apertar o botão direito do controle e vamos esperar a animação terminar.
Viu só quanto tempo demorou? Isso tudo é culpa do Java e de programadores
preguiçosos. Se tivesse sido escrito em C&mldr;"><meta http-equiv=Content-Security-Policy content="default-src 'self' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src *; object-src 'none'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; worker-src 'self' blob:; base-uri 'self'"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Programas escritos em C podem ser mais lentos</title><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-600.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-600.woff2 crossorigin><style type=text/css>@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}footer#page-footer,nav#site-nav{background:0 0;padding:1em}footer#page-footer,nav#site-nav{background:#282a2e;color:#c5c8c6;line-height:3em}nav#site-nav{display:flex;overflow:auto;scrollbar-width:none}nav#site-nav::-webkit-scrollbar{display:none}nav#site-nav a{display:inline-block;width:6em;font-weight:700;text-align:center;color:inherit;flex-shrink:0}@media screen and (min-width:60em){footer#page-footer,nav#site-nav{line-height:inherit}}@media screen and (min-width:60em){article{border-radius:.5em}body{margin:2em auto!important}}html{background:#252628}body{width:100%;max-width:60em;margin:0 auto;line-height:1.5em;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:100%;color:#c5c8c6}h1,h2,h3,h4,h5,h6{margin:1.1em 0 .83em}h1,h2,h3{color:#8c9440}h4,h5,h6{color:#b5bd68}h1{font-size:1.5em}h2{font-size:1.26em}h3{font-size:1.1em}h4{font-size:1.03em}h5{font-size:.67em}h6{font-size:.51em}a{text-decoration:initial;color:#de935f}a:hover{text-decoration:underline}em{color:#f0c674;font-style:normal}strong{color:#c66}nav#site-nav{border-radius:1em 1em 0 0;background:0 0;color:#c5c8c6}nav#site-nav a.push-right{margin-left:auto}nav#site-nav a.current{color:#81a2be}label#toc-toggle{display:flex;width:100%;margin-top:1em;height:3em;align-items:center;justify-content:center}input#toc-toggle-box{display:none}input#toc-toggle-box~nav#TableOfContents{display:none}input#toc-toggle-box:checked~nav#TableOfContents{display:block}nav#TableOfContents{margin:.5em 0 0;box-sizing:border-box;background:#282a2e;padding:1em;border-radius:.5em;overflow:hidden;font-weight:700;color:#de935f}nav#TableOfContents ul{margin:0;padding:0;list-style-type:none}nav#TableOfContents ul li{overflow:hidden;white-space:nowrap;text-overflow:' ...'}nav#TableOfContents ul li+li{margin-top:1em}nav#TableOfContents ul ul{padding-left:1em;margin-top:1em}@media screen and (min-width:60em){label#toc-toggle{display:none}input#toc-toggle-box~nav#TableOfContents{display:initial}nav#TableOfContents{float:right;margin:1em 0 1em 1em;max-width:40%;font-size:85%}nav#TableOfContents ul li+li{margin-top:initial}nav#TableOfContents ul ul{margin-top:initial}}footer#page-footer{background:0 0;color:#707880;display:grid;grid-auto-flow:column;grid-template-columns:minmax(0,1fr)}footer#page-footer a{color:#f0c674}footer#page-footer p#timestamp,footer#page-footer p#commit{margin:0}footer#page-footer p#timestamp{text-align:right}article{background:#1d1f21;padding:.1em 1.5em .8em}article header{font-weight:700}article header section.header-line{display:flex;justify-content:space-between;align-items:center}article header section.header-line h1{color:#8c9440;margin-bottom:.25em}article header section.header-line aside#translations{margin:1.1em 0 .25em}article header section.header-line aside#translations ul#translations{list-style:none;padding:0;margin:0;display:flex;justify-content:space-around;font-size:115%}article header section.header-line aside#translations ul#translations li:not(:first-child){margin-left:1em}article header section.subheader-line{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}article header section.subheader-line p.subtitle{color:#5e8d87;margin:0}article header section.subheader-line p.subtitle em{color:inherit;font-style:italic}article header section.subheader-line ul#article-tags{list-style-type:none;padding-left:0;margin:0;font-size:85%}article header section.subheader-line ul#article-tags li{display:inline-block}article header section.subheader-line ul#article-tags li:nth-child(n+2){margin-left:1em}article header section.subheader-line ul#article-tags li a{color:#f0c674}article blockquote{color:#707880;padding-left:1em;border-width:0 0 0 .5em;border-style:solid;border-color:#707880}article table{width:100%}article table th{color:#81a2be}article table td{color:#c5c8c6}article table td.date{width:1%;white-space:nowrap;padding:0 .5em 0 0}article input#search-box{background:#252628;color:#c5c8c6;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:initial;border:none;border-radius:.5em;text-align:center;width:100%;padding:.35em 1em;box-sizing:border-box;outline:none}article table#blog-index tr:hover{background:#282a2e}article table#blog-index td.title a{display:flex;width:100%;height:100%;align-items:center;min-height:2em}article table#blog-index td.tag{display:none;width:1em;text-align:right}article table#blog-index td.tag a{color:#f0c674}article table.compare-table{border-collapse:collapse}article table.compare-table th,article table.compare-table td{padding:.5em 1em;box-sizing:border-box}article table.compare-table th:first-child,article table.compare-table td:first-child{padding-left:0}article table.compare-table th:last-child,article table.compare-table td:last-child{padding-right:0}article table.compare-table th,article table.compare-table td:nth-child(n+2){text-align:center}article table.compare-table td{border-top:.1em solid #707880}article table.compare-table th:nth-child(n+2){min-width:4em}article li::marker{color:#f0c674}article figure{margin:1.25em 0;text-align:center}article figure img{min-height:5em;max-height:15em;width:100%;object-fit:cover;border-radius:1em}article figure figcaption p{margin-top:0}article code{font-family:inconsolata,dejavu sans mono,liberation mono,monospace;font-size:100%}article pre{background:#282a2e;border-radius:.5em;padding:.5em 1em;overflow-x:auto;line-height:initial}article>hr{color:#707880;opacity:.5;margin:2em 0}article p code,article li code{background:#282a2e;padding:0 .3em;border-radius:.25em}article>p a,article>ul li a,article>ol li a{text-decoration:underline}article ul#notebooks{list-style-type:square;padding-left:1em}article ul#notebooks ul.notes{list-style-type:disc;padding-left:1.5em}article ul.terms-by-count{display:grid;grid-template-columns:repeat(auto-fit,minmax(11em,1fr));list-style-type:none;padding-left:0;text-align:center}article.extra-pages h2~p{margin-left:2em}article section.dialog{display:flex;padding:1em;align-content:center;border-radius:.5em;border-width:.2em;border-style:solid;border-color:#707880;margin:.5em 0 0;box-sizing:border-box;max-width:100%}article section.dialog p:first-child{margin-top:0}article section.dialog p:last-child{margin-bottom:0}article section.dialog .dialog-icon{margin-right:1em}article section.dialog.dialog-info{border-color:#5f819d}article section.dialog.dialog-warning{border-color:#de935f}article section.dialog.dialog-error{border-color:#a54242}article section.dialog.dialog-success{border-color:#8c9440}article section.dialog.dialog-info strong,article section.dialog.dialog-info em,article section.dialog.dialog-success strong,article section.dialog.dialog-success em{color:inherit}article section.dialog.dialog-info em,article section.dialog.dialog-success em{font-style:italic}article section.microblog p.timestamp{color:#5e8d87;font-weight:700;font-size:90%;margin:1em 0}article section.microblog section.microblog-content{margin-left:1em}@media screen and (min-width:60em){article table#blog-index td.tag{display:table-cell}article section.dialog{margin:1em 0 0}article section.microblog{margin-left:1em}}section.github-card{display:inline-block;max-width:20em;min-width:15em;border-radius:.3em;border:.1em solid #707880;padding:.5em}section.github-card p,section.github-card a{margin:0}section.github-card hr{opacity:.5;color:#707880}section.github-card section#description,section.github-card section#more{line-height:1em}section.github-card section#header{display:flex;justify-content:space-between;height:3em}section.github-card section#header img{display:inline-block;height:3em;border-radius:.3em}section.github-card section#header section#title{flex-grow:1;padding:.2em .5em}section.github-card section#header section#stats{display:flex;align-items:center;justify-content:flex-end;min-width:2em;height:1.5em}section.github-card section#header section#stats svg{fill:#c5c8c6;height:1em}section.github-card section#header section#stats p.github-star{display:inline-block;font-size:90%;padding-left:.3em}section.github-card section#description{height:3em;text-overflow:ellipsis;overflow:hidden;padding:.5em 0 0}section.github-card section#description p{font-size:90%}section.github-card section#more{min-height:1em}section.github-card section#more p.language{display:inline-block;margin:0 .2em;border-radius:1em;padding:0 .35em;background:#c5c8c6;color:#1d1f21;font-size:90%}</style></head><body><nav id=site-nav><a href=/pt-br/ class=[]>Índice
</a><a href=/pt-br/blog/ class=[]>Blog
</a><a href=/pt-br/projects/ class=[]>Projetos
</a><a href=/pt-br/about/ class=push-right>Sobre</a></nav><main role=main><article id=content><header><section class=header-line><h1>Programas escritos em C podem ser mais lentos</h1><aside id=translations><ul id=translations><li><a href=/blog/c-isnt-string-friendly/ title=English><span role=img aria-label="United States flag">🇺🇸</span></a></li></ul></aside></section><section class=subheader-line><p class=subtitle>Melhor dizendo, pode ser que as escolha te faça fazê-los mais lentos!</p><ul id=article-tags><li><a href=/pt-br/tags/programa%C3%A7%C3%A3o>Programação</a></li><li><a href=/pt-br/tags/tecnologia>Tecnologia</a></li><li><a href=/pt-br/tags/opini%C3%B5es>Opiniões</a></li><li><a href=/pt-br/tags/desabafos>Desabafos</a></li></ul></section></header><p>Há uma década, se vocẽ me pedisse para falar sobre programação, eu, <em>jovem e
inexperiente,</em> provavelmente diria que todo mundo deveria programar em C, para
que todos os programas pudessem ter alta performance e que programadores que
reclamavam da linguagem eram preguiçosos demais para lidar com alocação de
memória e ponteiros. <strong>Que vergonha!</strong></p><p>Tenho certeza que eu atribuía qualquer lentidão ou delay a <em>desenvolvedores
Java preguiçosos:</em></p><blockquote><p>Vou apertar o botão direito do controle e vamos esperar a animação terminar.
Viu só quanto tempo demorou? Isso tudo é culpa do Java e de programadores
preguiçosos. Se tivesse sido escrito em C&mldr;</p><p>&mdash; Eu, apontando para uma smart TV</p></blockquote><p>Minha visão de mundo naturalmente mudou desde então. A tolice da juventude não
pode durar muito, afinal: cometer enganos e encontrar caminhos alternativos te
ensina mais rápido do que qualquer outro método. Haskell me ensinou como uma
linguagem elegante e sucinta ainda pode ser <a href=https://book.realworldhaskell.org/read/profiling-and-optimization.html>compilada e dar origem a programas
otimizados,</a> e com o tempo aprendi que otimização ao nível
arquitetural ou algorítmico tem um impacto muito maior em performance na
maioria dos casos.</p><p>O que eu quero dizer com este artigo, no entanto, <strong>não tem nada a ver com
otimizações de compilador,</strong> e apenas um pouco a ver com complexidade de
algoritmos. Muito se fala sobre como C continua sendo a linguagem de escolha
quando performance importa, mas sinto que não se fala o suficiente sobre a
preguiça inerente de programadores que fazem da linguagem, às vezes, uma
escolha ruim.</p><h2 id=um-exemplo-concreto-do-que-quero-dizer>Um exemplo concreto do que quero dizer</h2><p>O exemplo que me levou a tal conclusão é um caso específico, mas pessoalmente
frustrante, já que acabei de submeter uma pull request mudando mais de 900
linhas nesse projeto: <a href=https://github.com/kolbusa/stalonetray>stalonetray,</a> uma &ldquo;bandeja&rdquo; de sistema para
o X11. Especificamente, como ele traduz valores de parâmetros para valores
enumerados. Isso provavelmente já diz o suficiente para programadores C lendo
este artigo.</p><p>O seguinte trecho foi tirado de <a href=https://github.com/kolbusa/stalonetray/blob/4e92d630c8fe701d55e0f4493d989310adea3663/src/settings.c#L147-L156><code>src/settings.c</code></a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;none&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_NONE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;simple&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_SIMPLE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;wmaker&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_WMAKER;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span><span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>    <span style=color:#a6e22e>PARSING_ERROR</span>(<span style=color:#e6db74>&#34;none, simple, or wmaker expected&#34;</span>, str);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span>    <span style=color:#66d9ef>return</span> FAILURE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span>}</span></span></code></pre></div><p>Para os que por qualquer motivo não podem facilmente ler C, o trecho acima
segue o seguinte fluxo:</p><ol><li>Se a string <code>str</code> for igual a <code>"none"</code>, atribua o valor de <code>DOCKAPP_NONE</code> a
<code>**tgt</code>.</li><li>Caso contrário, se a string <code>str</code> for igual a <code>"simple"</code>, atribua o valor de
<code>DOCKAPP_SIMPLE</code> a <code>**tgt</code>.</li><li>Caso contrário, se a string <code>str</code> for igual a <code>"wmaker"</code>, atribua o valor de
<code>DOCKAPP_WMAKER</code> a <code>**tgt</code>.</li><li>Caso contrário, imprima uma mensagem de erro e retorne <code>FAILURE</code>.</li></ol><p>É importante explicar que apesar da presença de literais de string, <em>strings
não são membros de primeira classe em C.</em> Elas são ponteiros para o primeiro
caractere (<code>char</code>) da string, e a convenção diz que a string termina quando um
caractere com valor <code>0</code> (também representado por <code>'\0'</code>) é encontrado. Não há
forma mais simples de implementar strings em uma linguagem de programação.</p><p>Por conta disso, <em>comparação de strings é na verdade subtração de caracteres:</em>
uma definição base para a função <em><code>strcmp</code></em> da biblioteca padrão de C &mdash; a
função que &ldquo;cmp"ara &ldquo;str"ings &mdash; pode ser:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>b)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(; <span style=color:#f92672>*</span>a <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>b <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>b; a<span style=color:#f92672>++</span>, b<span style=color:#f92672>++</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Um pouco chato de decifrar? É, o loop <em><code>for</code></em> vazio não ajuda muito, e estamos
usando aritmética de ponteiros, também. Aqui está uma implementação
equivalente, mas com comentários explicando cada passo do algoritmo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>left, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>right)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Enquanto as strings &#39;left&#39; e &#39;right&#39; não tenham terminado, e seu
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// primeiro caractere for o mesmo...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>while</span> ( <span style=color:#f92672>*</span>left <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>right <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>right ) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Descartamos o primeiro caractere delas (dentro dessa função)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        left  <span style=color:#f92672>=</span> left  <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// left + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        right <span style=color:#f92672>=</span> right <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// right + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Caracteres em C são só bytes, então podemos subtrair seus valores
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// numéricos e o fazer cast implícito do resultado para int. Retornamos tal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// diferença e pronto.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>right;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Este é um algorítimo linear, com complexidade <em>O(n).</em> Uma comparação entre
strings iguais é o pior cenário possível, já que a função precisará iterar as
duas strings até achar dois caracteres diferentes ou o fim de uma delas.</p><p>Sendo assim, aquela cadeia de <em><code>if</code></em> que mostrei no começo do artigo é não só
ruim de ler, mas também não é a forma mais eficiente de fazer o que o código se
propõe a fazer. <em>Pode muito bem ser que performance não interesse muito nesse
caso em particular,</em> mas isso é irrelevante para o meu argumento. Se assumimos
uma situação em que o número de valores na enumeração possa crescer &mdash; e
consequentemente a cadeia de condicionais &mdash;, o uso desse estilo de código vai
nos levar a desperdiçar ciclos de CPU. Uma tabela hash seria muito mais
eficiente, <strong>mas será que ainda seria legível?</strong></p><h2 id=o-preguiçoso-programador>O preguiçoso programador</h2><p><em>Programadores procuram ser preguiçosos.</em> Programação é uma forma de
automatizar tarefas tediosas: deixar a máquina fazer o trabalho que não
queremos fazer nós mesmos, já que ela é capaz de processar números muito mais
rápido do que nós podemos. É natural que queiramos esquecer como a máquina
funciona por baixo, e focar em declarar o que queremos fazer <strong>da forma mais
concisa possível.</strong></p><p>Esta última colocação, combinada com o que foi dito ao final da seção anterior,
é o cerne do meu argumento: buscamos eficiência em nosso código, mas <em>mais do
que isso, buscamos eficiência no uso do nosso tempo e energia.</em> Se podemos
fazer o que queremos usando menos palavras, dificilmente pensaremos duas vezes.
No caso particular do trecho de código usado de exemplo, o programador
provavelmente pensou uma ou mais das seguintes coisas:</p><ul><li>Otimização prematura é a raiz de todo o mal.</li><li>Não há necessidade de performance aqui, esse parser roda apenas uma vez.</li><li>O tradeoff entre performance e legibilidade não vale a pena.</li><li>Isso é mais fácil de manter do que escrever uma tabela hash.</li><li>Vamos evitar reinventar a roda ou adicionar outra dependência.</li></ul><p>E assim nasceu aquela cadeia de condicionais! <strong>Não dá para culpar ninguém.</strong></p><h3 id=mas-seria-mesmo-tão-difícil-de-manter>Mas seria mesmo tão difícil de manter?</h3><p><a href=https://github.com/troydhanson/uthash/blob/master/src/uthash.h>Aqui</a> temos uma implementação simples de tabela hash genérica chamada
<em>uthash,</em> que poderia ter sido adicionada como dependência para tornar o código
mais legível. Dê uma olhada nos arquivos do projeto. Uma implementação
especializada para <code>const char * -> int</code> não seria muito diferente do que você
vê ali, exceto talvez pela presença de menos macros do pré-processador.</p><p>Em resumo, escrever isso do zero não seria uma experiência suave para o
programador, tanto na primeira escrita quanto na hora de manter o código no
futuro.</p><h3 id=o-que-deveríamos-fazer-então>O que deveríamos fazer, então?</h3><p>Sinto ter que dizer isso, mas <em>use uma linguagem moderna se você puder.</em> C está
aqui para ficar, e provavelmente vai continuar sendo bastante usada mesmo
depois que Rust e Go se tornem mais populares. É uma ótima linguagem para
programação de sistemas, mas se você vai usá-la, já sabe quais são as
desvantagens que vai enfrentar. Compare o trecho de código do stalonetray com
esses trechos escritos descuidadamente em outras linguagens.</p><h4 id=python>Python</h4><p>Tabelas hash existem no formato de dicionários, uma estrutura de dados já
presente na biblioteca padrão, com uma representação literal fácil de ler que
lembra JSON.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> enum <span style=color:#f92672>import</span> Enum
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DockAppMode</span>(Enum):
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dockapp_mode_dict <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;none&#34;</span>: DOCKAPP_NONE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;simple&#34;</span>: DOCKAPP_SIMPLE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;wmaker&#34;</span>: DOCKAPP_WMAKER
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_dockapp_mode</span>(s):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> dockapp_mode_dict[s]
</span></span></code></pre></div><h4 id=haskell>Haskell</h4><p>Tabelas hash existem na forma do tipo <code>Map</code>, de <code>Data.Map</code>, mas temos
ferramentas mais modernas para fazer o que queremos. Aqui estão algumas
possibilidade, começando com uma <em>instância derivada da classe <code>Read</code>:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#75715e>-- Com isso, você pode só usar &#39;None&#39;, &#39;Simple&#39;, ou &#39;WMaker&#39; nas strings!</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>DockAppMode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Simple</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>WMaker</span> <span style=color:#66d9ef>deriving</span> (<span style=color:#66d9ef>Show</span>, <span style=color:#66d9ef>Read</span>)
</span></span></code></pre></div><p>Também dá para usar pattern matching e deixar que o compilador otimize o que
queremos. Assim não precisamos fazer a comparação de strings nós mesmos com
outra função, ou com cadeias de condicionais:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Maybe</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;none&#34;</span>   <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;simple&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>Simple</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;wmaker&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>WMaker</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#66d9ef>_</span>        <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nothing</span>
</span></span></code></pre></div><p>E finalmente, usando um mapa:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#66d9ef>import</span> Data.Map
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Map</span> <span style=color:#66d9ef>String</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>=</span> fromList [(<span style=color:#e6db74>&#34;none&#34;</span>, <span style=color:#66d9ef>None</span>), (<span style=color:#e6db74>&#34;simple&#34;</span>, <span style=color:#66d9ef>Simple</span>), (<span style=color:#e6db74>&#34;wmaker&#34;</span>, <span style=color:#66d9ef>WMaker</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>=</span> (_dockAppModeMap <span style=color:#f92672>!</span>)
</span></span></code></pre></div><h4 id=java>Java</h4><p>Tabelas hash existem na forma da classe <code>HashMap</code>, e strings são tipos de
primeira classe:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Example</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> DockAppMode {
</span></span><span style=display:flex><span>        NONE, SIMPLE, WMAKER
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span> dockAppModeMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span>() {{
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;none&#34;</span>, DockAppMode.<span style=color:#a6e22e>NONE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;simple&#34;</span>, DockAppMode.<span style=color:#a6e22e>SIMPLE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;wmaker&#34;</span>, DockAppMode.<span style=color:#a6e22e>WMAKER</span>);
</span></span><span style=display:flex><span>    }};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DockAppMode <span style=color:#a6e22e>parseDockAppMode</span>(String s) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dockAppModeMap.<span style=color:#a6e22e>get</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Não vou escrever mais do que isso aí.</p><h4 id=rust>Rust</h4><p>A linguagem que muitos dizem ser a sucessora do C. Não parece existir açúcar
sintático para tabelas hash, mas a biblioteca padrão tem <a href=https://doc.rust-lang.org/book/ch08-03-hash-maps.html>uma coleção <code>HashMap</code>
que podemos usar</a>, e assim como Haskell, Rust também oferece
<a href=https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html>pattern matching.</a> Não posso nem fingir que sei escrever código
em Rust, e minhas tentativas de compilar alguma coisa decente foram rejeitadas
pelo compilador.</p></article></main><footer id=page-footer><p id=commit><a href=https://github.com/d3adb5/website/commit/5323fc92bb259386e57cb52c47341d49e001c2c1>5323fc9</a></p><p id=timestamp>Published in June 8, 2023</p></footer></body></html>