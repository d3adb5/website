<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="H√° uma d√©cada, se voc·∫Ω me pedisse para falar sobre programa√ß√£o, eu, jovem e
inexperiente, provavelmente diria que todo mundo deveria programar em C, para
que todos os programas pudessem ter alta performance e que programadores que
reclamavam da linguagem eram pregui√ßosos demais para lidar com aloca√ß√£o de
mem√≥ria e ponteiros. Que vergonha!
Tenho certeza que eu atribu√≠a qualquer lentid√£o ou delay a desenvolvedores
Java pregui√ßosos:

Vou apertar o bot√£o direito do controle e vamos esperar a anima√ß√£o terminar.
Viu s√≥ quanto tempo demorou? Isso tudo √© culpa do Java e de programadores
pregui√ßosos. Se tivesse sido escrito em C&mldr;"><meta http-equiv=Content-Security-Policy content="default-src 'self' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src *; object-src 'none'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; worker-src 'self' blob:; base-uri 'self'"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Programas escritos em C podem ser mais lentos</title><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-600.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-600.woff2 crossorigin><style type=text/css>@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}footer#page-footer,nav#site-nav{background:0 0;padding:1em}footer#page-footer,nav#site-nav{background:#282a2e;color:#c5c8c6;line-height:3em}nav#site-nav{display:flex;overflow:auto;scrollbar-width:none}nav#site-nav::-webkit-scrollbar{display:none}nav#site-nav a{display:inline-block;width:6em;font-weight:700;text-align:center;color:inherit;flex-shrink:0}@media screen and (min-width:60em){footer#page-footer,nav#site-nav{line-height:inherit}}html{background:#252628}body{width:100%;max-width:60em;margin:0 auto;line-height:1.5em;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:100%;color:#c5c8c6}@media screen and (min-width:60em){body{margin:2em auto!important}}h1,h2,h3,h4,h5,h6{margin:1.1em 0 .83em}h1,h2,h3{color:#8c9440}h4,h5,h6{color:#b5bd68}h1{font-size:1.5em}h2{font-size:1.26em}h3{font-size:1.1em}h4{font-size:1.03em}h5{font-size:.67em}h6{font-size:.51em}a{text-decoration:initial;color:#de935f}a:hover{text-decoration:underline}em{color:#f0c674;font-style:normal}strong{color:#c66}nav#site-nav{border-radius:1em 1em 0 0;background:0 0;color:#c5c8c6}nav#site-nav a.push-right{margin-left:auto}nav#site-nav a.current{color:#81a2be}label#toc-toggle{display:flex;width:100%;margin-top:1em;height:3em;align-items:center;justify-content:center}input#toc-toggle-box{display:none}input#toc-toggle-box~nav#TableOfContents{display:none}input#toc-toggle-box:checked~nav#TableOfContents{display:block}nav#TableOfContents{margin:.5em 0 0;box-sizing:border-box;background:#282a2e;padding:1em;border-radius:.5em;overflow:hidden;font-weight:700;color:#de935f}nav#TableOfContents ul{margin:0;padding:0;list-style-type:none}nav#TableOfContents ul li{overflow:hidden;white-space:nowrap;text-overflow:' ...'}nav#TableOfContents ul li+li{margin-top:1em}nav#TableOfContents ul ul{padding-left:1em;margin-top:1em}@media screen and (min-width:60em){nav#TableOfContents{float:right;margin:1em 0 1em 1em;max-width:40%;font-size:85%}nav#TableOfContents ul li+li{margin-top:initial}nav#TableOfContents ul ul{margin-top:initial}}@media screen and (min-width:60em){label#toc-toggle{display:none}}@media screen and (min-width:60em){input#toc-toggle-box~nav#TableOfContents{display:initial}}footer#page-footer{background:0 0;color:#707880;display:grid;grid-auto-flow:column;grid-template-columns:minmax(0,1fr)}footer#page-footer a{color:#f0c674}footer#page-footer span.commit-subject{color:#de935f;margin-left:.5em}footer#page-footer p#commit{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}footer#page-footer p#commit span.commit-hash{font-family:inconsolata,dejavu sans mono,liberation mono,monospace}footer#page-footer p#timestamp,footer#page-footer p#commit{margin:0}footer#page-footer p#timestamp{text-align:right}article{background:#1d1f21;padding:.1em 1.5em .8em}@media screen and (min-width:60em){article{border-radius:.5em}}article header{font-weight:700}article header section.header-line{display:flex;justify-content:space-between;align-items:center}article header section.header-line h1{color:#8c9440;margin-bottom:.25em}article header section.header-line aside#translations{margin:1.1em 0 .25em}article header section.header-line aside#translations ul#translations{list-style:none;padding:0;margin:0;display:flex;justify-content:space-around;font-size:115%}article header section.header-line aside#translations ul#translations li:not(:first-child){margin-left:1em}article header section.subheader-line{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}article header section.subheader-line p.subtitle{color:#5e8d87;margin:0}article header section.subheader-line p.subtitle em{color:inherit;font-style:italic}article header section.subheader-line ul#article-tags{list-style-type:none;padding-left:0;margin:0;font-size:85%}article header section.subheader-line ul#article-tags li{display:inline-block}article header section.subheader-line ul#article-tags li:nth-child(n+2){margin-left:1em}article header section.subheader-line ul#article-tags li a{color:#f0c674}article blockquote{color:#979a98;padding-left:1em;border:0 solid #707880;border-left-width:.5em}article table{width:100%}article table th{color:#81a2be}article table td{color:#c5c8c6}article table td.date{width:1%;white-space:nowrap;padding:0 .5em 0 0}article table.compare-table{border-collapse:collapse}article table.compare-table th,article table.compare-table td{padding:.5em 1em;box-sizing:border-box}article table.compare-table th:first-child,article table.compare-table td:first-child{padding-left:0}article table.compare-table th:last-child,article table.compare-table td:last-child{padding-right:0}article table.compare-table th,article table.compare-table td:nth-child(n+2){text-align:center}article table.compare-table td{border-top:.1em solid #707880}article table.compare-table th:nth-child(n+2){min-width:4em}article li::marker{color:#f0c674}article figure{margin:1.25em 0;text-align:center}article figure img{min-height:5em;max-height:15em;width:100%;object-fit:cover;border-radius:1em}article figure figcaption p{margin-top:0}article code{font-family:inconsolata,dejavu sans mono,liberation mono,monospace;font-size:100%}article pre{background:#282a2e;border-radius:.5em;padding:.5em 1em;overflow-x:auto;line-height:initial}article>hr{color:#707880;opacity:.5;margin:2em 0}article p code,article li code{background:#282a2e;padding:0 .3em;border-radius:.25em}article>p a,article>ul li a,article>ol li a{text-decoration:underline}article.extra-pages h2~p{margin-left:2em}article section.dialog{display:flex;padding:1em;align-content:center;border-radius:.5em;border:.2em solid #707880;margin:.5em 0 0;box-sizing:border-box;max-width:100%}article section.dialog p:first-child{margin-top:0}article section.dialog p:last-child{margin-bottom:0}article section.dialog .dialog-icon{margin-right:1em}article section.dialog.dialog-info{border-color:#5f819d}article section.dialog.dialog-warning{border-color:#de935f}article section.dialog.dialog-error{border-color:#a54242}article section.dialog.dialog-success{border-color:#8c9440}@media screen and (min-width:60em){article section.dialog{margin:1em 0 0}}</style></head><body><nav id=site-nav><a href class=[]>√çndice
</a><a href=/pt-br/blog/ class=[]>Blog</a></nav><main role=main><article id=content><header><section class=header-line><h1>Programas escritos em C podem ser mais lentos</h1><aside id=translations><ul id=translations><li><a href=/blog/c-isnt-string-friendly/ title=English><span role=img aria-label="United States flag">üá∫üá∏</span></a></li></ul></aside></section><section class=subheader-line><p class=subtitle>Melhor dizendo, pode ser que as escolha te fa√ßa faz√™-los mais lentos!</p><ul id=article-tags><li><a href=/pt-br/tags/programa%C3%A7%C3%A3o>Programa√ß√£o</a></li><li><a href=/pt-br/tags/tecnologia>Tecnologia</a></li><li><a href=/pt-br/tags/opini%C3%B5es>Opini√µes</a></li><li><a href=/pt-br/tags/desabafos>Desabafos</a></li></ul></section></header><p>H√° uma d√©cada, se voc·∫Ω me pedisse para falar sobre programa√ß√£o, eu, <em>jovem e
inexperiente,</em> provavelmente diria que todo mundo deveria programar em C, para
que todos os programas pudessem ter alta performance e que programadores que
reclamavam da linguagem eram pregui√ßosos demais para lidar com aloca√ß√£o de
mem√≥ria e ponteiros. <strong>Que vergonha!</strong></p><p>Tenho certeza que eu atribu√≠a qualquer lentid√£o ou delay a <em>desenvolvedores
Java pregui√ßosos:</em></p><blockquote><p>Vou apertar o bot√£o direito do controle e vamos esperar a anima√ß√£o terminar.
Viu s√≥ quanto tempo demorou? Isso tudo √© culpa do Java e de programadores
pregui√ßosos. Se tivesse sido escrito em C&mldr;</p><p>&mdash; Eu, apontando para uma smart TV</p></blockquote><p>Minha vis√£o de mundo naturalmente mudou desde ent√£o. A tolice da juventude n√£o
pode durar muito, afinal: cometer enganos e encontrar caminhos alternativos te
ensina mais r√°pido do que qualquer outro m√©todo. Haskell me ensinou como uma
linguagem elegante e sucinta ainda pode ser <a href=https://book.realworldhaskell.org/read/profiling-and-optimization.html>compilada e dar origem a programas
otimizados,</a> e com o tempo aprendi que otimiza√ß√£o ao n√≠vel
arquitetural ou algor√≠tmico tem um impacto muito maior em performance na
maioria dos casos.</p><p>O que eu quero dizer com este artigo, no entanto, <strong>n√£o tem nada a ver com
otimiza√ß√µes de compilador,</strong> e apenas um pouco a ver com complexidade de
algoritmos. Muito se fala sobre como C continua sendo a linguagem de escolha
quando performance importa, mas sinto que n√£o se fala o suficiente sobre a
pregui√ßa inerente de programadores que fazem da linguagem, √†s vezes, uma
escolha ruim.</p><h2 id=um-exemplo-concreto-do-que-quero-dizer>Um exemplo concreto do que quero dizer</h2><p>O exemplo que me levou a tal conclus√£o √© um caso espec√≠fico, mas pessoalmente
frustrante, j√° que acabei de submeter uma pull request mudando mais de 900
linhas nesse projeto: <a href=https://github.com/kolbusa/stalonetray>stalonetray,</a> uma &ldquo;bandeja&rdquo; de sistema para
o X11. Especificamente, como ele traduz valores de par√¢metros para valores
enumerados. Isso provavelmente j√° diz o suficiente para programadores C lendo
este artigo.</p><p>O seguinte trecho foi tirado de <a href=https://github.com/kolbusa/stalonetray/blob/4e92d630c8fe701d55e0f4493d989310adea3663/src/settings.c#L147-L156><code>src/settings.c</code></a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;none&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_NONE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;simple&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_SIMPLE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;wmaker&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_WMAKER;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span><span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>    <span style=color:#a6e22e>PARSING_ERROR</span>(<span style=color:#e6db74>&#34;none, simple, or wmaker expected&#34;</span>, str);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span>    <span style=color:#66d9ef>return</span> FAILURE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span>}</span></span></code></pre></div><p>Para os que por qualquer motivo n√£o podem facilmente ler C, o trecho acima
segue o seguinte fluxo:</p><ol><li>Se a string <code>str</code> for igual a <code>"none"</code>, atribua o valor de <code>DOCKAPP_NONE</code> a
<code>**tgt</code>.</li><li>Caso contr√°rio, se a string <code>str</code> for igual a <code>"simple"</code>, atribua o valor de
<code>DOCKAPP_SIMPLE</code> a <code>**tgt</code>.</li><li>Caso contr√°rio, se a string <code>str</code> for igual a <code>"wmaker"</code>, atribua o valor de
<code>DOCKAPP_WMAKER</code> a <code>**tgt</code>.</li><li>Caso contr√°rio, imprima uma mensagem de erro e retorne <code>FAILURE</code>.</li></ol><p>√â importante explicar que apesar da presen√ßa de literais de string, <em>strings
n√£o s√£o membros de primeira classe em C.</em> Elas s√£o ponteiros para o primeiro
caractere (<code>char</code>) da string, e a conven√ß√£o diz que a string termina quando um
caractere com valor <code>0</code> (tamb√©m representado por <code>'\0'</code>) √© encontrado. N√£o h√°
forma mais simples de implementar strings em uma linguagem de programa√ß√£o.</p><p>Por conta disso, <em>compara√ß√£o de strings √© na verdade subtra√ß√£o de caracteres:</em>
uma defini√ß√£o base para a fun√ß√£o <em><code>strcmp</code></em> da biblioteca padr√£o de C &mdash; a
fun√ß√£o que &ldquo;cmp"ara &ldquo;str"ings &mdash; pode ser:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>b)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(; <span style=color:#f92672>*</span>a <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>b <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>b; a<span style=color:#f92672>++</span>, b<span style=color:#f92672>++</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Um pouco chato de decifrar? √â, o loop <em><code>for</code></em> vazio n√£o ajuda muito, e estamos
usando aritm√©tica de ponteiros, tamb√©m. Aqui est√° uma implementa√ß√£o
equivalente, mas com coment√°rios explicando cada passo do algoritmo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>left, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>right)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Enquanto as strings &#39;left&#39; e &#39;right&#39; n√£o tenham terminado, e seu
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// primeiro caractere for o mesmo...
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> ( <span style=color:#f92672>*</span>left <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>right <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>right ) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Descartamos o primeiro caractere delas (dentro dessa fun√ß√£o)
</span></span></span><span style=display:flex><span>        left  <span style=color:#f92672>=</span> left  <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// left + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span>        right <span style=color:#f92672>=</span> right <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// right + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Caracteres em C s√£o s√≥ bytes, ent√£o podemos subtrair seus valores
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// num√©ricos e o fazer cast impl√≠cito do resultado para int. Retornamos tal
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// diferen√ßa e pronto.
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>right;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Este √© um algor√≠timo linear, com complexidade <em>O(n).</em> Uma compara√ß√£o entre
strings iguais √© o pior cen√°rio poss√≠vel, j√° que a fun√ß√£o precisar√° iterar as
duas strings at√© achar dois caracteres diferentes ou o fim de uma delas.</p><p>Sendo assim, aquela cadeia de <em><code>if</code></em> que mostrei no come√ßo do artigo √© n√£o s√≥
ruim de ler, mas tamb√©m n√£o √© a forma mais eficiente de fazer o que o c√≥digo se
prop√µe a fazer. <em>Pode muito bem ser que performance n√£o interesse muito nesse
caso em particular,</em> mas isso √© irrelevante para o meu argumento. Se assumimos
uma situa√ß√£o em que o n√∫mero de valores na enumera√ß√£o possa crescer &mdash; e
consequentemente a cadeia de condicionais &mdash;, o uso desse estilo de c√≥digo vai
nos levar a desperdi√ßar ciclos de CPU. Uma tabela hash seria muito mais
eficiente, <strong>mas ser√° que ainda seria leg√≠vel?</strong></p><h2 id=o-pregui√ßoso-programador>O pregui√ßoso programador</h2><p><em>Programadores procuram ser pregui√ßosos.</em> Programa√ß√£o √© uma forma de
automatizar tarefas tediosas: deixar a m√°quina fazer o trabalho que n√£o
queremos fazer n√≥s mesmos, j√° que ela √© capaz de processar n√∫meros muito mais
r√°pido do que n√≥s podemos. √â natural que queiramos esquecer como a m√°quina
funciona por baixo, e focar em declarar o que queremos fazer <strong>da forma mais
concisa poss√≠vel.</strong></p><p>Esta √∫ltima coloca√ß√£o, combinada com o que foi dito ao final da se√ß√£o anterior,
√© o cerne do meu argumento: buscamos efici√™ncia em nosso c√≥digo, mas <em>mais do
que isso, buscamos efici√™ncia no uso do nosso tempo e energia.</em> Se podemos
fazer o que queremos usando menos palavras, dificilmente pensaremos duas vezes.
No caso particular do trecho de c√≥digo usado de exemplo, o programador
provavelmente pensou uma ou mais das seguintes coisas:</p><ul><li>Otimiza√ß√£o prematura √© a raiz de todo o mal.</li><li>N√£o h√° necessidade de performance aqui, esse parser roda apenas uma vez.</li><li>O tradeoff entre performance e legibilidade n√£o vale a pena.</li><li>Isso √© mais f√°cil de manter do que escrever uma tabela hash.</li><li>Vamos evitar reinventar a roda ou adicionar outra depend√™ncia.</li></ul><p>E assim nasceu aquela cadeia de condicionais! <strong>N√£o d√° para culpar ningu√©m.</strong></p><h3 id=mas-seria-mesmo-t√£o-dif√≠cil-de-manter>Mas seria mesmo t√£o dif√≠cil de manter?</h3><p><a href=https://github.com/troydhanson/uthash/blob/master/src/uthash.h>Aqui</a> temos uma implementa√ß√£o simples de tabela hash gen√©rica chamada
<em>uthash,</em> que poderia ter sido adicionada como depend√™ncia para tornar o c√≥digo
mais leg√≠vel. D√™ uma olhada nos arquivos do projeto. Uma implementa√ß√£o
especializada para <code>const char * -> int</code> n√£o seria muito diferente do que voc√™
v√™ ali, exceto talvez pela presen√ßa de menos macros do pr√©-processador.</p><p>Em resumo, escrever isso do zero n√£o seria uma experi√™ncia suave para o
programador, tanto na primeira escrita quanto na hora de manter o c√≥digo no
futuro.</p><h3 id=o-que-dever√≠amos-fazer-ent√£o>O que dever√≠amos fazer, ent√£o?</h3><p>Sinto ter que dizer isso, mas <em>use uma linguagem moderna se voc√™ puder.</em> C est√°
aqui para ficar, e provavelmente vai continuar sendo bastante usada mesmo
depois que Rust e Go se tornem mais populares. √â uma √≥tima linguagem para
programa√ß√£o de sistemas, mas se voc√™ vai us√°-la, j√° sabe quais s√£o as
desvantagens que vai enfrentar. Compare o trecho de c√≥digo do stalonetray com
esses trechos escritos descuidadamente em outras linguagens.</p><h4 id=python>Python</h4><p>Tabelas hash existem no formato de dicion√°rios, uma estrutura de dados j√°
presente na biblioteca padr√£o, com uma representa√ß√£o literal f√°cil de ler que
lembra JSON.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> enum <span style=color:#f92672>import</span> Enum
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DockAppMode</span>(Enum):
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dockapp_mode_dict <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;none&#34;</span>: DOCKAPP_NONE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;simple&#34;</span>: DOCKAPP_SIMPLE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;wmaker&#34;</span>: DOCKAPP_WMAKER
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_dockapp_mode</span>(s):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> dockapp_mode_dict[s]
</span></span></code></pre></div><h4 id=haskell>Haskell</h4><p>Tabelas hash existem na forma do tipo <code>Map</code>, de <code>Data.Map</code>, mas temos
ferramentas mais modernas para fazer o que queremos. Aqui est√£o algumas
possibilidade, come√ßando com uma <em>inst√¢ncia derivada da classe <code>Read</code>:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#75715e>-- Com isso, voc√™ pode s√≥ usar &#39;None&#39;, &#39;Simple&#39;, ou &#39;WMaker&#39; nas strings!</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>DockAppMode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Simple</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>WMaker</span> <span style=color:#66d9ef>deriving</span> (<span style=color:#66d9ef>Show</span>, <span style=color:#66d9ef>Read</span>)
</span></span></code></pre></div><p>Tamb√©m d√° para usar pattern matching e deixar que o compilador otimize o que
queremos. Assim n√£o precisamos fazer a compara√ß√£o de strings n√≥s mesmos com
outra fun√ß√£o, ou com cadeias de condicionais:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Maybe</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;none&#34;</span>   <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;simple&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>Simple</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;wmaker&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>WMaker</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#66d9ef>_</span>        <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nothing</span>
</span></span></code></pre></div><p>E finalmente, usando um mapa:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#66d9ef>import</span> Data.Map
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Map</span> <span style=color:#66d9ef>String</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>=</span> fromList [(<span style=color:#e6db74>&#34;none&#34;</span>, <span style=color:#66d9ef>None</span>), (<span style=color:#e6db74>&#34;simple&#34;</span>, <span style=color:#66d9ef>Simple</span>), (<span style=color:#e6db74>&#34;wmaker&#34;</span>, <span style=color:#66d9ef>WMaker</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>=</span> (_dockAppModeMap <span style=color:#f92672>!</span>)
</span></span></code></pre></div><h4 id=java>Java</h4><p>Tabelas hash existem na forma da classe <code>HashMap</code>, e strings s√£o tipos de
primeira classe:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Example</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> DockAppMode {
</span></span><span style=display:flex><span>        NONE, SIMPLE, WMAKER
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span> dockAppModeMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span>() {{
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;none&#34;</span>, DockAppMode.<span style=color:#a6e22e>NONE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;simple&#34;</span>, DockAppMode.<span style=color:#a6e22e>SIMPLE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;wmaker&#34;</span>, DockAppMode.<span style=color:#a6e22e>WMAKER</span>);
</span></span><span style=display:flex><span>    }};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DockAppMode <span style=color:#a6e22e>parseDockAppMode</span>(String s) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dockAppModeMap.<span style=color:#a6e22e>get</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>N√£o vou escrever mais do que isso a√≠.</p><h4 id=rust>Rust</h4><p>A linguagem que muitos dizem ser a sucessora do C. N√£o parece existir a√ß√∫car
sint√°tico para tabelas hash, mas a biblioteca padr√£o tem <a href=https://doc.rust-lang.org/book/ch08-03-hash-maps.html>uma cole√ß√£o <code>HashMap</code>
que podemos usar</a>, e assim como Haskell, Rust tamb√©m oferece
<a href=https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html>pattern matching.</a> N√£o posso nem fingir que sei escrever c√≥digo
em Rust, e minhas tentativas de compilar alguma coisa decente foram rejeitadas
pelo compilador.</p></article></main><footer id=page-footer><p id=commit><a href=https://github.com/d3adb5/website/commit/5323fc92bb259386e57cb52c47341d49e001c2c1><span class=commit-hash>5323fc9</span><span class=commit-subject>content(blog): translate article on c perf</span></a></p><p id=timestamp>Updated June 9, 2023</p></footer></body></html>