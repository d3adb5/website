<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="DISCLAIMER: N√£o me declaro ex√≠mio conhecedor de Git, muito menos algu√©m
extremamente experiente com ferramentas de controle de vers√£o. Este artigo est√°
sendo escrito enquanto decido o que quero para os meus pr√≥prios projetos, e
como enxergo a aplica√ß√£o de cada &ldquo;filosofia&rdquo;, por assim dizer. O tema √©
controverso de maneiras que at√© me fugiam da cabe√ßa.
Observa√ß√£o: Assume-se aqui um conhecimento decente de Git e de sua
terminologia. Alguns comandos ser√£o exibidos, mas explica√ß√µes sobre o que √©
commit, branch, etc. n√£o estar√£o presentes. Links para documenta√ß√£o ser√£o
inseridos de forma branda."><meta http-equiv=Content-Security-Policy content="default-src 'self' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src *; object-src 'none'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; worker-src 'self' blob:; base-uri 'self'"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Hist√≥rico linear com Git: rebase, merge, squash</title><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-600.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-600.woff2 crossorigin><style type=text/css>@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}footer#page-footer,nav#site-nav{background:0 0;padding:1em}footer#page-footer,nav#site-nav{background:#282a2e;color:#c5c8c6;line-height:3em}nav#site-nav{display:flex;overflow:auto;scrollbar-width:none}nav#site-nav::-webkit-scrollbar{display:none}nav#site-nav a{display:inline-block;width:6em;font-weight:700;text-align:center;color:inherit;flex-shrink:0}@media screen and (min-width:60em){footer#page-footer,nav#site-nav{line-height:inherit}}html{background:#252628}body{width:100%;max-width:60em;margin:0 auto;line-height:1.5em;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:100%;color:#c5c8c6}@media screen and (min-width:60em){body{margin:2em auto!important}}h1,h2,h3,h4,h5,h6{margin:1.1em 0 .83em}h1,h2,h3{color:#8c9440}h4,h5,h6{color:#b5bd68}h1{font-size:1.5em}h2{font-size:1.26em}h3{font-size:1.1em}h4{font-size:1.03em}h5{font-size:.67em}h6{font-size:.51em}a{text-decoration:initial;color:#de935f}a:hover{text-decoration:underline}em{color:#f0c674;font-style:normal}strong{color:#c66}nav#site-nav{border-radius:1em 1em 0 0;background:0 0;color:#c5c8c6}nav#site-nav a.push-right{margin-left:auto}nav#site-nav a.current{color:#81a2be}label#toc-toggle{display:flex;width:100%;margin-top:1em;height:3em;align-items:center;justify-content:center}input#toc-toggle-box{display:none}input#toc-toggle-box~nav#TableOfContents{display:none}input#toc-toggle-box:checked~nav#TableOfContents{display:block}nav#TableOfContents{margin:.5em 0 0;box-sizing:border-box;background:#282a2e;padding:1em;border-radius:.5em;overflow:hidden;font-weight:700;color:#de935f}nav#TableOfContents ul{margin:0;padding:0;list-style-type:none}nav#TableOfContents ul li{overflow:hidden;white-space:nowrap;text-overflow:' ...'}nav#TableOfContents ul li+li{margin-top:1em}nav#TableOfContents ul ul{padding-left:1em;margin-top:1em}@media screen and (min-width:60em){nav#TableOfContents{float:right;margin:1em 0 1em 1em;max-width:40%;font-size:85%}nav#TableOfContents ul li+li{margin-top:initial}nav#TableOfContents ul ul{margin-top:initial}}@media screen and (min-width:60em){label#toc-toggle{display:none}}@media screen and (min-width:60em){input#toc-toggle-box~nav#TableOfContents{display:initial}}footer#page-footer{background:0 0;color:#707880;display:grid;grid-auto-flow:column;grid-template-columns:minmax(0,1fr)}footer#page-footer a{color:#f0c674}footer#page-footer span.commit-subject{color:#de935f;margin-left:.5em}footer#page-footer p#commit{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}footer#page-footer p#commit span.commit-hash{font-family:inconsolata,dejavu sans mono,liberation mono,monospace}footer#page-footer p#timestamp,footer#page-footer p#commit{margin:0}footer#page-footer p#timestamp{text-align:right}article{background:#1d1f21;padding:.1em 1.5em .8em}@media screen and (min-width:60em){article{border-radius:.5em}}article header{font-weight:700}article header section.header-line{display:flex;justify-content:space-between;align-items:center}article header section.header-line h1{color:#8c9440;margin-bottom:.25em}article header section.header-line aside#translations{margin:1.1em 0 .25em}article header section.header-line aside#translations ul#translations{list-style:none;padding:0;margin:0;display:flex;justify-content:space-around;font-size:115%}article header section.header-line aside#translations ul#translations li:not(:first-child){margin-left:1em}article header section.subheader-line{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}article header section.subheader-line p.subtitle{color:#5e8d87;margin:0}article header section.subheader-line p.subtitle em{color:inherit;font-style:italic}article header section.subheader-line ul#article-tags{list-style-type:none;padding-left:0;margin:0;font-size:85%}article header section.subheader-line ul#article-tags li{display:inline-block}article header section.subheader-line ul#article-tags li:nth-child(n+2){margin-left:1em}article header section.subheader-line ul#article-tags li a{color:#f0c674}article blockquote{color:#979a98;padding-left:1em;border:0 solid #707880;border-left-width:.5em}article table{width:100%}article table th{color:#81a2be}article table td{color:#c5c8c6}article table td.date{width:1%;white-space:nowrap;padding:0 .5em 0 0}article table.compare-table{border-collapse:collapse}article table.compare-table th,article table.compare-table td{padding:.5em 1em;box-sizing:border-box}article table.compare-table th:first-child,article table.compare-table td:first-child{padding-left:0}article table.compare-table th:last-child,article table.compare-table td:last-child{padding-right:0}article table.compare-table th,article table.compare-table td:nth-child(n+2){text-align:center}article table.compare-table td{border-top:.1em solid #707880}article table.compare-table th:nth-child(n+2){min-width:4em}article li::marker{color:#f0c674}article figure{margin:1.25em 0;text-align:center}article figure img{min-height:5em;max-height:15em;width:100%;object-fit:cover;border-radius:1em}article figure figcaption p{margin-top:0}article code{font-family:inconsolata,dejavu sans mono,liberation mono,monospace;font-size:100%}article pre{background:#282a2e;border-radius:.5em;padding:.5em 1em;overflow-x:auto;line-height:initial}article>hr{color:#707880;opacity:.5;margin:2em 0}article p code,article li code{background:#282a2e;padding:0 .3em;border-radius:.25em}article>p a,article>ul li a,article>ol li a{text-decoration:underline}article.extra-pages h2~p{margin-left:2em}article section.dialog{display:flex;padding:1em;align-content:center;border-radius:.5em;border:.2em solid #707880;margin:.5em 0 0;box-sizing:border-box;max-width:100%}article section.dialog p:first-child{margin-top:0}article section.dialog p:last-child{margin-bottom:0}article section.dialog .dialog-icon{margin-right:1em}article section.dialog.dialog-info{border-color:#5f819d}article section.dialog.dialog-warning{border-color:#de935f}article section.dialog.dialog-error{border-color:#a54242}article section.dialog.dialog-success{border-color:#8c9440}@media screen and (min-width:60em){article section.dialog{margin:1em 0 0}}</style></head><body><nav id=site-nav><a href class=[]>√çndice
</a><a href=/pt-br/blog/ class=[]>Blog</a></nav><main role=main><article id=content><header><section class=header-line><h1>Hist√≥rico linear com Git: rebase, merge, squash</h1><aside id=translations><ul id=translations><li><a href=/blog/git-rebase-vs-merge/ title=English><span role=img aria-label="United States flag">üá∫üá∏</span></a></li></ul></aside></section><section class=subheader-line><p class=subtitle>Rebase ou n√£o, eis a quest√£o&mldr;</p><ul id=article-tags><li><a href=/pt-br/tags/versionamento>Versionamento</a></li><li><a href=/pt-br/tags/git>Git</a></li><li><a href=/pt-br/tags/tecnologia>Tecnologia</a></li><li><a href=/pt-br/tags/opini%C3%B5es>Opini√µes</a></li></ul></section></header><p><strong>DISCLAIMER:</strong> N√£o me declaro ex√≠mio conhecedor de Git, muito menos algu√©m
extremamente experiente com ferramentas de controle de vers√£o. Este artigo est√°
sendo escrito enquanto decido o que quero para os meus pr√≥prios projetos, e
como enxergo a aplica√ß√£o de cada &ldquo;filosofia&rdquo;, por assim dizer. O tema √©
controverso de maneiras que at√© me fugiam da cabe√ßa.</p><p><em>Observa√ß√£o:</em> Assume-se aqui um conhecimento decente de Git e de sua
terminologia. Alguns comandos ser√£o exibidos, mas explica√ß√µes sobre o que √©
<code>commit</code>, <code>branch</code>, etc. n√£o estar√£o presentes. Links para documenta√ß√£o ser√£o
inseridos de forma branda.</p><h2 id=o-que-√©-um-hist√≥rico-linear>O que √© um hist√≥rico linear?</h2><p>O hist√≥rico de commits de um reposit√≥rio √© dito linear (√†s vezes semi-linear)
quanto n√£o h√° caminhos paralelos de desenvolvimento com mudan√ßas vis√≠veis. Ou
seja, tais mudan√ßas seguem uma ordem estrita, se n√£o cronol√≥gica, ao menos
sequencial. Em palavras mais sucintas, d√° para seguir o hist√≥rico de <code>commit</code>s
sem precisar dividir a leitura em &ldquo;galhos&rdquo; (<code>branch</code>) em nenhum momento.</p><p>Exemplo de um hist√≥rico linear:</p><pre tabindex=0><code>* a64cdd6 feat(bar): extend new feature
* 8bce4d5 feat(bar): introduce new feature
* 12757f0 feat(foo): send processed info to server
* f26b0a5 feat(foo): process some information
* 3016bae chore: starting this repository
</code></pre><p>Claramente as commits seguem uma ordem direta: <code>3016bae</code>, depois <code>f26b0a5</code>, e
por a√≠ vai at√© chegarmos √† commit <code>a64cdd6</code>. Perfeito para entendermos a
evolu√ß√£o do projeto, se pudermos contar com o fato das mensagens de commit
resumirem bem o prop√≥sito das mudan√ßas que introduzem.</p><p>Projetos, mesmo de pequena escala, costumam implementar fluxos de trabalho que
&mdash; ao menos no papel &mdash; seguem a m√°xima de &ldquo;crie <code>commit</code>s frequentemente, e
para cada <em>feature</em>, um <code>branch</code>&rdquo;. Um <code>git merge</code> aqui e ali, e criamos um
&ldquo;mapa do metr√¥&rdquo; no nosso hist√≥rico.</p><p>Se tentamos preservar a linearidade em casos como o descrito, antes de cada
<code>merge</code> possivelmente vir√° um <code>rebase</code>. No final, preferindo uma <code>commit</code> de
<em>merge</em> a um <em>fast-forward</em>, nosso hist√≥rico toma a apar√™ncia outrora chamada
de semi-linear:</p><pre tabindex=0><code>*   1d26fed merge: feature/bar into master
|\
| * be56591 feat(bar): extend new feature
| * ad2cf56 feat(bar): introduce new feature
|/
*   189e487 merge: feature/foo into master
|\
| * 36d49e6 feat(foo): send processed info to server
| * 1528f6c feat(foo): process some information
|/
* 3ad35f0 chore: starting this repository
</code></pre><p>Apesar de tecnicamente existirem caminhos paralelos, por via de regra somente
um deles faz mudan√ßas, enquanto o outro √© um elo direto entre a <em>base</em> do
caminho significativo, e o seu ponto final. Sendo assim, n√£o perdemos a
capacidade de seguir as mudan√ßas feitas na √°rvore de arquivos em sequ√™ncia.</p><p>Para tal, basta &ldquo;planificar&rdquo; o hist√≥rico acima. O resultado, sem contar os
hashes de cada <em>commit</em>, √© o mesmo do primeiro hist√≥rico apresentado. Os
n√≠veis, caminhos, camadas, como queira chamar, servem o papel de identificar,
com uma olhada r√°pida, o come√ßo e o final de cada <em>super-etapa</em> do processo de
desenvolvimento, ou pelo menos os momentos em que paramos para revisar o que
fizemos.</p><h3 id=mapa-do-metr√¥>Mapa do metr√¥</h3><p>Para quem n√£o o conhece por esse nome, o seguinte exemplo configura o tipo de
hist√≥rico que chamamos de &ldquo;mapa do metr√¥&rdquo;:</p><pre tabindex=0><code>*   1805ccb merge: bar into master
|\
| * 9232bac feat(bar): more stuff
| * 87ddf92 feat(bar): do stuff
* | 2cb78b7 something changed again
* |   1e7e0e8 merge: foo into master
|\ \
| * | 4b0d990 feat(foo): add something else
| * | 51fb8b4 feat(foo): something something
| |/
* / 26339fc whoops, something changed here
|/
* f51dc43 chore: start
</code></pre><p>Perceba como fica dif√≠cil de ler o hist√≥rico como uma sequ√™ncia bem ordenada
das mudan√ßas feitas no c√≥digo. N√£o que isso n√£o seja poss√≠vel ou a maneira
correta de usar o Git: muito pelo contr√°rio, o Git foi feito com a capacidade
de ligar diferentes ramos de desenvolvimento em mente, j√° que muitas pessoas
trabalhando numa mesma √°rvore de arquivos n√£o podem sempre parar para atualizar
seus hist√≥ricos locais. Em vez disso, trabalha-se na esperan√ßa de que no final
n√£o haver√£o <em>conflitos de merge</em>.</p><h2 id=qual-o-sentido-do-hist√≥rico-para-voc√™-e-o-git>Qual o sentido do hist√≥rico para voc√™? E o Git?</h2><p>Antes de entrar no assunto de vantagens e desvantagens de um hist√≥rico linear,
acho necess√°rio tratar do prop√≥sito do hist√≥rico de commits, que, querendo ou
n√£o, tem um aspecto subjetivo. Apesar do Git ser um software de controle de
vers√£o, a pergunta <em>&ldquo;Que vers√µes estamos guardando?&rdquo;</em> √© mais do que pertinente.</p><p>Veja algumas poss√≠veis respostas:</p><ul><li>Toda vers√£o do c√≥digo guardada por um desenvolvedor quando considerou as
mudan√ßas suficientes para criar uma commit.</li><li>Toda vers√£o do c√≥digo que passa nos testes automatizados.</li><li>Todo o trajeto de desenvolvimento do projeto, lido ou n√£o de forma sequencial.</li><li>Tudo que acharmos ser pertinente, mesmo que falhe nos testes, na compila√ß√£o,
ou at√© em seu funcionamento.</li></ul><p>Talvez a inten√ß√£o de cada resposta se explique pela inten√ß√£o no uso do Git.
Queremos preservar a hist√≥ria como ela realmente ocorreu, ou queremos elaborar
uma hist√≥ria de desenvolvimento enxuta e compreens√≠vel? Se encontramos um bug,
ca√ßamos a mudan√ßa que introduziu o bug usando <code>git bisect</code> e testes
automatizados, ou s√≥ procuramos o peda√ßo de c√≥digo que est√° causando problemas?</p><p><strong>Na minha opini√£o,</strong> o hist√≥rico mostra a evolu√ß√£o do projeto e n√£o o
envolvimento de cada desenvolvedor. Digo isso porque vejo o hist√≥rico de
mudan√ßas como parte da documenta√ß√£o, e um documento com se√ß√µes semelhantes
espalhadas em 30 folhas de papel √© mais dif√≠cil de ler do que se tais se√ß√µes
fossem aglutinadas em uma s√≥ lista.</p><p>O ideal √© que nenhuma commit introduza erros, e hooks do Git podem ser usados
para rodar testes antes de criar commits novas, mas na realidade, seja por
descuido, por capricho, ou por conta do <code>rebase</code>, frequentemente criamos
commits que deixam os testes a desejar. <a href=https://medium.com/@fredrikmorken/why-you-should-stop-using-git-rebase-5552bee4fed1>Este artigo</a>
explica uma das desvantagens de se usar o comando <code>git rebase</code>, mas o faz do
ponto de vista de quem usar o Git para descobrir a origem de algum erro, ou
como uma &ldquo;rede de seguran√ßa&rdquo;.</p><p>Pergunto ao leitor:</p><ol><li><p>Defensores da estrat√©gia de <em>merge</em> afirmam que s√£o poucas as pessoas que
sabem usar o comando <em>rebase</em>. Quantas pessoas voc√™ conhece que sabem n√£o s√≥
da exist√™ncia do <em>bisect</em>, mas tamb√©m como o usar?</p></li><li><p>Usar o Git como ferramenta de debug depende n√£o s√≥ de um teste bem escrito
para o <em>bisect</em>, que √© compat√≠vel at√© o seu ponto de partida, mas tamb√©m de
desenvolvedores que testam suas altera√ß√µes antes de fazer qualquer commit.
Isso lhe parece uma situa√ß√£o comum?</p></li><li><p>Defensores da estrat√©gia de <em>merge</em> afirmam que fazer <em>rebase</em> √© &ldquo;reescrever
a hist√≥ria&rdquo;. De fato o √©, mas se a hist√≥ria envolve altera√ß√µes que quebram o
processo de build ou de teste, o <em>bisect</em> n√£o iria nos falhar de qualquer
forma?</p></li><li><p>Podemos fazer <em>squash</em> das commits antes delas serem incorporadas e garantir
que funcionem, gerando maior confian√ßa no <em>bisect</em>, mas&mldr; isso n√£o √©
reescrever a hist√≥ria do mesmo jeito?</p></li></ol><p>√â um artigo bem escrito e que traz um argumento interessante, mas que apela
para uma compet√™ncia maior do que a necess√°ria para fazer um mero <em>rebase</em>. E
afinal, se todo desenvolvedor testasse suas altera√ß√µes antes de criar commits,
<em>por que ter√≠amos builds de CI?</em></p><h2 id=situa√ß√µes-pr√°ticas>Situa√ß√µes pr√°ticas</h2><p>Parece uma perspectiva pessimista e at√© arrogante, mas a maioria dos
desenvolvedores, independente da empresa, criar√° commits sem fazer testes, sem
revisar as pr√≥prias mudan√ßas, sem atualizar o seu hist√≥rico local antes de
criar seu <em>branch</em>. N√£o pense nisso como uma cr√≠tica, pois quem vos fala √©
culpado dos mesmos pecados. Em vez disso, enxergue minhas palavras como
par√°frase do ditado &ldquo;errar √© humano&rdquo;.</p><p>Partindo deste m√∫tuo entendimento de que &ldquo;vamos fazer besteira&rdquo;, √© poss√≠vel
imaginar as situa√ß√µes reais que podem surgir ao aplicar uma estrat√©gia sobre a
outra, e inclusive dar nomes aos resultados:</p><ol><li><p><em>Vale-tudo, caos,</em> ou <em>dura realidade:</em> preservar a hist√≥ria como ela √©,
mantendo qualquer altera√ß√£o feita pelo desenvolvedor, mesmo que seu branch
comece 80 commits atr√°s, e 80% das altera√ß√µes a serem incorporadas s√£o para
a resolu√ß√£o de conflitos. Como n√£o h√° <em>squash</em> e talvez nem builds de CI,
n√£o √© poss√≠vel garantir que toda commit do reposit√≥rio passe na fase de
testes.</p><ul><li><strong>N√£o</strong> d√° para ler o hist√≥rico sequencialmente.</li><li><strong>N√£o</strong> d√° para encontrar erros facilmente com <em>bisect</em>.</li><li>A hist√≥ria de cada desenvolvedor √© <em>preservada</em>.</li></ul></li><li><p><em>Mudan√ßas espremidas</em> ou <em>bombas de c√≥digo:</em> fazer <em>squash</em> das commits
antes de cada <em>merge</em>, com branches que podem ter partido de qualquer
situa√ß√£o, j√° que ao final somente uma commit ser√° incorporada. Assuma que
builds de CI garantem que cada commit, que passa a ser uma bomba de c√≥digo de
potencialmente milhares de linhas, passe na fase de testes.</p><ul><li><em>D√°</em> para ler o hist√≥rico sequencialmente, <strong>mas</strong> com bombas de c√≥digo.</li><li><em>D√°</em> para encontrar erros com <em>bisect</em>, <strong>mas</strong> eles se escondem em grandes
diffs.</li><li>A hist√≥ria de cada desenvolvedor <strong>n√£o</strong> √© preservada.</li></ul></li><li><p><em>Linearidade ainda que tardia:</em> fazer um <em>rebase</em> antes de cada merge,
garantindo que as mudan√ßas a serem incorporadas possam partir da vers√£o mais
recente do seu destino, mesmo que isso signifique abandonar commits que antes
passariam na fase de testes sem problemas.</p><ul><li><em>D√°</em> para ler o hist√≥rico sequencialmente.</li><li><em>D√°</em> para encontrar erros com <em>bisect</em>, <strong>mas</strong> com chance de falsos
positivos.</li><li>A hist√≥ria de cada desenvolvedor <strong>n√£o</strong> √© preservada.</li></ul></li><li><p><em>Ditadura do teste autom√°tico:</em> linearidade j√° n√£o √© mais o foco, e sim a
aprova√ß√£o de <strong>toda</strong> commit na fase de testes. O desenvolvedor √© obrigado a
garantir que toda commit sendo enviada passe na fase de testes, e que n√£o h√°
conflitos de <em>merge</em>. Sob a press√£o de n√£o mostrar fraqueza e ser chamado de
imbecil, ele faz todas as altera√ß√µes de que precisa de uma vez s√≥ e roda os
testes antes de enviar a sua √∫nica singela commit, que poderia muito bem ter
sido resultado de um <em>squash</em> no momento da incorpora√ß√£o, como √© o caso na
situa√ß√£o 2.</p><ul><li><em>D√°</em> para ler o hist√≥rico sequencialmente, <strong>mas</strong> com grandes chances de
ver bombas de c√≥digo.</li><li><em>D√°</em> para encontrar erros com <em>bisect</em>, <strong>mas</strong> eles v√£o quase que de certo
se esconder em grandes diffs.</li><li>A hist√≥ria de cada desenvolvedor <em>√© apavorante, mas preservada.</em></li></ul></li></ol><p>No momento estou apostando na situa√ß√£o 3 como a menos ruim.</p></article></main><footer id=page-footer><p id=commit><a href=https://github.com/d3adb5/website/commit/538f1828a225229364fac663e3a9549e8db8e1d9><span class=commit-hash>538f182</span><span class=commit-subject>feat: add tags to existing blog posts</span></a></p><p id=timestamp>Updated May 14, 2023</p></footer></body></html>