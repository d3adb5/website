<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="If you asked me what I thought of programming about a decade ago, my young,
inexperienced, zealot self would have likely told you everybody should be
programming in C, so that all programs could be really fast, and that
programmers who complained about the language were just too lazy to deal with
memory allocation and pointers. How mistaken I was!
I&rsquo;m pretty sure I attributed every bit of slow software or transition to lazy
Java programmers:"><meta http-equiv=Content-Security-Policy content="default-src 'self' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src *; object-src 'none'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; worker-src 'self' blob:; base-uri 'self'"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Writing your program in C can make it slower</title><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-600.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-600.woff2 crossorigin><style type=text/css>@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}footer#page-footer,nav#site-nav{background:0 0;padding:1em}footer#page-footer,nav#site-nav{background:#282a2e;color:#c5c8c6;line-height:3em}nav#site-nav{display:flex;overflow:auto;scrollbar-width:none}nav#site-nav::-webkit-scrollbar{display:none}nav#site-nav a{display:inline-block;width:6em;font-weight:700;text-align:center;color:inherit;flex-shrink:0}@media screen and (min-width:60em){footer#page-footer,nav#site-nav{line-height:inherit}}@media screen and (min-width:60em){article{border-radius:.5em}body{margin:2em auto!important}}html{background:#252628}body{width:100%;max-width:60em;margin:0 auto;line-height:1.5em;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:100%;color:#c5c8c6}h1,h2,h3,h4,h5,h6{margin:1.1em 0 .83em}h1,h2,h3{color:#8c9440}h4,h5,h6{color:#b5bd68}h1{font-size:1.5em}h2{font-size:1.26em}h3{font-size:1.1em}h4{font-size:1.03em}h5{font-size:.67em}h6{font-size:.51em}a{text-decoration:initial;color:#de935f}a:hover{text-decoration:underline}em{color:#f0c674;font-style:normal}strong{color:#c66}nav#site-nav{border-radius:1em 1em 0 0;background:0 0;color:#c5c8c6}nav#site-nav a.push-right{margin-left:auto}nav#site-nav a.current{color:#81a2be}label#toc-toggle{display:flex;width:100%;margin-top:1em;height:3em;align-items:center;justify-content:center}input#toc-toggle-box{display:none}input#toc-toggle-box~nav#TableOfContents{display:none}input#toc-toggle-box:checked~nav#TableOfContents{display:block}nav#TableOfContents{margin:.5em 0 0;box-sizing:border-box;background:#282a2e;padding:1em;border-radius:.5em;overflow:hidden;font-weight:700;color:#de935f}nav#TableOfContents ul{margin:0;padding:0;list-style-type:none}nav#TableOfContents ul li{overflow:hidden;white-space:nowrap;text-overflow:' ...'}nav#TableOfContents ul li+li{margin-top:1em}nav#TableOfContents ul ul{padding-left:1em;margin-top:1em}@media screen and (min-width:60em){label#toc-toggle{display:none}input#toc-toggle-box~nav#TableOfContents{display:initial}nav#TableOfContents{float:right;margin:1em 0 1em 1em;max-width:40%;font-size:85%}nav#TableOfContents ul li+li{margin-top:initial}nav#TableOfContents ul ul{margin-top:initial}}footer#page-footer{background:0 0;color:#707880;display:grid;grid-auto-flow:column;grid-template-columns:minmax(0,1fr)}footer#page-footer a{color:#f0c674}footer#page-footer p#timestamp,footer#page-footer p#commit{margin:0}footer#page-footer p#timestamp{text-align:right}article{background:#1d1f21;padding:.1em 1.5em .8em}article header{font-weight:700}article header section.header-line{display:flex;justify-content:space-between;align-items:center}article header section.header-line h1{color:#8c9440;margin-bottom:.25em}article header section.header-line aside#translations{margin:1.1em 0 .25em}article header section.header-line aside#translations ul#translations{list-style:none;padding:0;margin:0;display:flex;justify-content:space-around;font-size:115%}article header section.header-line aside#translations ul#translations li:not(:first-child){margin-left:1em}article header section.subheader-line{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}article header section.subheader-line p.subtitle{color:#5e8d87;margin:0}article header section.subheader-line p.subtitle em{color:inherit;font-style:italic}article header section.subheader-line ul#article-tags{list-style-type:none;padding-left:0;margin:0;font-size:85%}article header section.subheader-line ul#article-tags li{display:inline-block}article header section.subheader-line ul#article-tags li:nth-child(n+2){margin-left:1em}article header section.subheader-line ul#article-tags li a{color:#f0c674}article blockquote{color:#707880;padding-left:1em;border-width:0 0 0 .5em;border-style:solid;border-color:#707880}article table{width:100%}article table th{color:#81a2be}article table td{color:#c5c8c6}article table td.date{width:1%;white-space:nowrap;padding:0 .5em 0 0}article input#search-box{background:#252628;color:#c5c8c6;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:initial;border:none;border-radius:.5em;text-align:center;width:100%;padding:.35em 1em;box-sizing:border-box;outline:none}article table#blog-index tr:hover{background:#282a2e}article table#blog-index td.title a{display:flex;width:100%;height:100%;align-items:center;min-height:2em}article table#blog-index td.tag{display:none;width:1em;text-align:right}article table#blog-index td.tag a{color:#f0c674}article table.compare-table{border-collapse:collapse}article table.compare-table th,article table.compare-table td{padding:.5em 1em;box-sizing:border-box}article table.compare-table th:first-child,article table.compare-table td:first-child{padding-left:0}article table.compare-table th:last-child,article table.compare-table td:last-child{padding-right:0}article table.compare-table th,article table.compare-table td:nth-child(n+2){text-align:center}article table.compare-table td{border-top:.1em solid #707880}article table.compare-table th:nth-child(n+2){min-width:4em}article li::marker{color:#f0c674}article figure{margin:1.25em 0;text-align:center}article figure img{min-height:5em;max-height:15em;width:100%;object-fit:cover;border-radius:1em}article figure figcaption p{margin-top:0}article code{font-family:inconsolata,dejavu sans mono,liberation mono,monospace;font-size:100%}article pre{background:#282a2e;border-radius:.5em;padding:.5em 1em;overflow-x:auto;line-height:initial}article>hr{color:#707880;opacity:.5;margin:2em 0}article p code,article li code{background:#282a2e;padding:0 .3em;border-radius:.25em}article>p a,article>ul li a,article>ol li a{text-decoration:underline}article ul#notebooks{list-style-type:square;padding-left:1em}article ul#notebooks ul.notes{list-style-type:disc;padding-left:1.5em}article ul.terms-by-count{display:grid;grid-template-columns:repeat(auto-fit,minmax(11em,1fr));list-style-type:none;padding-left:0;text-align:center}article.extra-pages h2~p{margin-left:2em}article section.dialog{display:flex;padding:1em;align-content:center;border-radius:.5em;border-width:.2em;border-style:solid;border-color:#707880;margin:.5em 0 0;box-sizing:border-box;max-width:100%}article section.dialog p:first-child{margin-top:0}article section.dialog p:last-child{margin-bottom:0}article section.dialog .dialog-icon{margin-right:1em}article section.dialog.dialog-info{border-color:#5f819d}article section.dialog.dialog-warning{border-color:#de935f}article section.dialog.dialog-error{border-color:#a54242}article section.dialog.dialog-success{border-color:#8c9440}article section.dialog.dialog-info strong,article section.dialog.dialog-info em,article section.dialog.dialog-success strong,article section.dialog.dialog-success em{color:inherit}article section.dialog.dialog-info em,article section.dialog.dialog-success em{font-style:italic}article section.microblog p.timestamp{color:#5e8d87;font-weight:700;font-size:90%;margin:1em 0}article section.microblog section.microblog-content{margin-left:1em}@media screen and (min-width:60em){article table#blog-index td.tag{display:table-cell}article section.dialog{margin:1em 0 0}article section.microblog{margin-left:1em}}section.github-card{display:inline-block;max-width:20em;min-width:15em;border-radius:.3em;border:.1em solid #707880;padding:.5em}section.github-card p,section.github-card a{margin:0}section.github-card hr{opacity:.5;color:#707880}section.github-card section#description,section.github-card section#more{line-height:1em}section.github-card section#header{display:flex;justify-content:space-between;height:3em}section.github-card section#header img{display:inline-block;height:3em;border-radius:.3em}section.github-card section#header section#title{flex-grow:1;padding:.2em .5em}section.github-card section#header section#stats{display:flex;align-items:center;justify-content:flex-end;min-width:2em;height:1.5em}section.github-card section#header section#stats svg{fill:#c5c8c6;height:1em}section.github-card section#header section#stats p.github-star{display:inline-block;font-size:90%;padding-left:.3em}section.github-card section#description{height:3em;text-overflow:ellipsis;overflow:hidden;padding:.5em 0 0}section.github-card section#description p{font-size:90%}section.github-card section#more{min-height:1em}section.github-card section#more p.language{display:inline-block;margin:0 .2em;border-radius:1em;padding:0 .35em;background:#c5c8c6;color:#1d1f21;font-size:90%}</style></head><body><nav id=site-nav><a href=/ class=[]>Home
</a><a href=/blog/ class=[]>Blog
</a><a href=/glob/ class=[]>Glob
</a><a href=/projects/ class=[]>Projects
</a><a href=/about/ class=push-right>About</a></nav><main role=main><article id=content><header><section class=header-line><h1>Writing your program in C can make it slower</h1><aside id=translations><ul id=translations><li><a href=/pt-br/blog/c-isnt-string-friendly/ title="Português Brasileiro"><span role=img aria-label="Bandeira do Brasil">🇧🇷</span></a></li></ul></aside></section><section class=subheader-line><p class=subtitle>Or rather, it can compell you to make it slower!</p><ul id=article-tags><li><a href=/tags/programming>Programming</a></li><li><a href=/tags/technology>Technology</a></li><li><a href=/tags/opinions>Opinions</a></li><li><a href=/tags/rants>Rants</a></li></ul></section></header><p>If you asked me what I thought of programming about a decade ago, my <em>young,
inexperienced, zealot self</em> would have likely told you everybody should be
programming in C, so that all programs could be really fast, and that
programmers who complained about the language were just too lazy to deal with
memory allocation and pointers. <strong>How mistaken I was!</strong></p><p>I&rsquo;m pretty sure I attributed every bit of slow software or transition to <em>lazy
Java programmers:</em></p><blockquote><p>Here, I&rsquo;m gonna press the right button on the remote and let&rsquo;s wait for the
animation to be over. See how many seconds that took? That&rsquo;s the fault of
Java and lazy programmers. If it had been written in C&mldr;</p><p>&mdash; Me, pointing to a smart TV interface</p></blockquote><p>My views have naturally changed since then. The folly of youth can only last so
long, after all: making mistakes and finding alternative routes teaches you
more quickly than any other avenue. Haskell taught me how an elegant language
can still be <a href=https://book.realworldhaskell.org/read/profiling-and-optimization.html>compiled into optimal programs,</a> and time
showed me optimization at an algorithmic and architectural level has much
greater an impact on performance.</p><p>What I with to allude to in this post, however, has <strong>nothing to do with
compiler optimizations,</strong> and only a little to do with algorithmic complexity.
Much is said about how C continues to be the go-to language for performance
sensitive applications, but I feel like not enough is said about the inherent
laziness of programmers making the language sometimes a poor choice.</p><h2 id=a-concrete-example-of-what-im-talking-about>A concrete example of what I&rsquo;m talking about</h2><p>The example that led me to this realization is a niche, but frustrating one &mdash;
personally frustrating, as I just submitted a 900+ lines patch to it &mdash;
<a href=https://github.com/kolbusa/stalonetray>stalonetray,</a> a standalone system tray for X11. Specifically how
it translates parameter values to enumerated values. That likely gives it away
to the C programmers reading this.</p><p>The following snippet was taken from <a href=https://github.com/kolbusa/stalonetray/blob/4e92d630c8fe701d55e0f4493d989310adea3663/src/settings.c#L147-L156><code>src/settings.c</code></a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;none&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_NONE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;simple&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_SIMPLE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span><span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>strcmp</span>(str, <span style=color:#e6db74>&#34;wmaker&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span>    <span style=color:#f92672>**</span>tgt <span style=color:#f92672>=</span> DOCKAPP_WMAKER;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span><span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>    <span style=color:#a6e22e>PARSING_ERROR</span>(<span style=color:#e6db74>&#34;none, simple, or wmaker expected&#34;</span>, str);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span>    <span style=color:#66d9ef>return</span> FAILURE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span>}</span></span></code></pre></div><p>For the sake of those who for some reason can&rsquo;t easily read C, the above
snippet goes through the following steps:</p><ol><li>If the string <code>str</code> is equal to <code>"none"</code>, set the value of <code>**tgt</code> to the
value of <code>DOCKAPP_NONE</code>.</li><li>Otherwise, if the string <code>str</code> is equal to <code>"simple"</code>, set the value of
<code>**tgt</code> to the value of <code>DOCKAPP_SIMPLE</code>.</li><li>Otherwise, if the string <code>str</code> is equal to <code>"wmaker"</code>, set the value of
<code>**tgt</code> to the value of <code>DOCKAPP_WMAKER</code>.</li><li>Otherwise, print an error message and return <code>FAILURE</code>.</li></ol><p>It is important to note that despite the presence of string literals, <em>C
strings are not first-class values in C.</em> They are pointers to the first
character of said string, and the string is said to end when a character with
the value of <code>0</code> (also written <code>'\0'</code>) is found. There is no simpler
implementation than this one in a programming language.</p><p>Because of that, <em>string comparison is really character subtraction:</em> a naive
definition for the C standard library&rsquo;s <em><code>strcmp</code></em> function &mdash; its totally
creative name stands for string comparison &mdash; is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>b)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(; <span style=color:#f92672>*</span>a <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>b <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>b; a<span style=color:#f92672>++</span>, b<span style=color:#f92672>++</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>a <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A little cryptic? We do have an empty <em><code>for</code></em> loop there, and make use of
pointer arithmetic. Here&rsquo;s an equivalent implementation, but with inline
comments explaining each step of our algorithm:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>strcmp</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>left, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>right)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// While the left and right strings are not over, and their first character
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// is the same...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>while</span> ( <span style=color:#f92672>*</span>left <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>right <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>right ) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Discard their first characters in this function.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        left  <span style=color:#f92672>=</span> left  <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// left + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        right <span style=color:#f92672>=</span> right <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// right + 1 points to the next char in the string.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Characters in C are just bytes, so we can subtract their numeric values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// and implicitly cast the result to int. Return such a difference.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>*</span>left <span style=color:#f92672>-</span> <span style=color:#f92672>*</span>right;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a linear algorithm, with complexity <em>O(n).</em> A comparison between equal
strings is the worst case scenario, as the function iterates both strings until
it finds two different characters or the end of either string.</p><p>So the chain of <em><code>if</code></em> statements in the snippet I showed you isn&rsquo;t just ugly,
it&rsquo;s not the most efficient way to do what the code purports itself to do.
<em>Let&rsquo;s forget whether performance matters for this particular scenario,</em> as
that isn&rsquo;t relevant at this time. Assuming there is a real chance of the number
of enumerations &mdash; and consequently the chain of conditionals &mdash; increasing,
the code starts to accumulate wasted CPU cycles. A hash table would be much
more efficient, <em>but would it read as well?</em></p><h2 id=the-lazy-programmer>The lazy programmer</h2><p><em>Programmers strive to be lazy.</em> Computer programming is a way to automate
otherwise tedious tasks: let the machine do the work we don&rsquo;t want to do
ourselves, as it can crunch numbers much faster than we can. It is only natural
for us to want to forget about how the underlying machine works, and focus on
declaring what we want to do <strong>in the most concise way possible.</strong></p><p>This last sentence, combined with what has already been said, is the crux of my
argument: we seek efficiency in our code, but <em>more importantly we seek
efficiency in the use of our time and energy.</em> If we can achieve what we want
with fewer words, we&rsquo;ll hardly think twice about it. In the particular case of
the snippet I showed you, the programmer likely thought one or more of:</p><ul><li>Premature optimization is the root of all evil.</li><li>There is no need for performance here, this parser runs only once.</li><li>The tradeoff between performance and readability is not worth it.</li><li>This is more maintainable than writing a hash table.</li><li>Let&rsquo;s avoid reinventing the wheel or adding another dependency.</li></ul><p>And so the chain of conditionals was born! <strong>Hardly a cardinal sin.</strong></p><h3 id=but-would-it-really-be-unmaintainable>But would it really be unmaintainable?</h3><p><a href=https://github.com/troydhanson/uthash/blob/master/src/uthash.h>This</a> is a simple generic hash table implementation called <em>uthash,</em>
which could&rsquo;ve been added as a dependency to make the code more readable. Have
a read through the project&rsquo;s files. A specific <code>const char * -> int</code>
implementation wouldn&rsquo;t be too different from what you see there, except
perhaps for the appearance of fewer preprocessor macros.</p><p>Summarizing, the programmer wouldn&rsquo;t have a great time writing it, or reading
it in the future.</p><h3 id=so-what-should-we-do>So what should we do?</h3><p>I hate to say this, but <em>use a modern language if you can.</em> The C programming
language is here to stay, likely for a long time after Rust and Go become more
widespread. It&rsquo;s a great systems programming language, but if you&rsquo;re going to
use it, you already know what setbacks, if any, stand in your way. Compare the
stalonetray snippet to these naive, carelessly written snippets.</p><h4 id=python>Python</h4><p>Hash tables exist as dictionaries, a built-in data structure, with an easy to
read literal representation that resembles JSON.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> enum <span style=color:#f92672>import</span> Enum
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DockAppMode</span>(Enum):
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dockapp_mode_dict <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;none&#34;</span>: DOCKAPP_NONE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;simple&#34;</span>: DOCKAPP_SIMPLE,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;wmaker&#34;</span>: DOCKAPP_WMAKER
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_dockapp_mode</span>(s):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> dockapp_mode_dict[s]
</span></span></code></pre></div><h4 id=haskell>Haskell</h4><p>Hash tables exist as the <code>Map</code> type from <code>Data.Map</code>, but we have more modern
tools to do what we want. Here are a few possibilities, starting with a <em>derived
instance of the <code>Read</code> typeclass:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#75715e>-- With this, just use &#39;None&#39;, &#39;Simple&#39;, or &#39;WMaker&#39; for the strings!</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>DockAppMode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Simple</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>WMaker</span> <span style=color:#66d9ef>deriving</span> (<span style=color:#66d9ef>Show</span>, <span style=color:#66d9ef>Read</span>)
</span></span></code></pre></div><p>We can also take advantage of pattern matching and let the compiler figure out
how to optimize it for us. No need to compare strings ourselves with another
function, or write a chain of <code>if-then-else</code> statements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Maybe</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;none&#34;</span>   <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;simple&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>Simple</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#e6db74>&#34;wmaker&#34;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Just</span> <span style=color:#66d9ef>WMaker</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode</span> <span style=color:#66d9ef>_</span>        <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nothing</span>
</span></span></code></pre></div><p>Finally, using a map:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#66d9ef>import</span> Data.Map
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Map</span> <span style=color:#66d9ef>String</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>_dockAppModeMap</span> <span style=color:#f92672>=</span> fromList [(<span style=color:#e6db74>&#34;none&#34;</span>, <span style=color:#66d9ef>None</span>), (<span style=color:#e6db74>&#34;simple&#34;</span>, <span style=color:#66d9ef>Simple</span>), (<span style=color:#e6db74>&#34;wmaker&#34;</span>, <span style=color:#66d9ef>WMaker</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>DockAppMode</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseDockAppMode&#39;</span> <span style=color:#f92672>=</span> (_dockAppModeMap <span style=color:#f92672>!</span>)
</span></span></code></pre></div><h4 id=java>Java</h4><p>Hash tables exist as the <code>HashMap</code> class, and strings are a first-class type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Example</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> DockAppMode {
</span></span><span style=display:flex><span>        NONE, SIMPLE, WMAKER
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span> dockAppModeMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String, DockAppMode<span style=color:#f92672>&gt;</span>() {{
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;none&#34;</span>, DockAppMode.<span style=color:#a6e22e>NONE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;simple&#34;</span>, DockAppMode.<span style=color:#a6e22e>SIMPLE</span>);
</span></span><span style=display:flex><span>        put(<span style=color:#e6db74>&#34;wmaker&#34;</span>, DockAppMode.<span style=color:#a6e22e>WMAKER</span>);
</span></span><span style=display:flex><span>    }};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DockAppMode <span style=color:#a6e22e>parseDockAppMode</span>(String s) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dockAppModeMap.<span style=color:#a6e22e>get</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I am not writing any more than that.</p><h4 id=rust>Rust</h4><p>The language some claim will become the new C. While there is no syntactic
sugar for hash tables, the standard library has <a href=https://doc.rust-lang.org/book/ch08-03-hash-maps.html>a <code>HashMap</code>
collection</a> we can use, and like Haskell it also offers <a href=https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html>pattern
matching.</a> I can&rsquo;t even pretend to know Rust, and my silly
attempts at compiling something for this were rejected by Rust&rsquo;s compiler.</p></article></main><footer id=page-footer><p id=commit><a href=https://github.com/d3adb5/website/commit/538f1828a225229364fac663e3a9549e8db8e1d9>538f182</a></p><p id=timestamp>Published in May 11, 2023</p></footer></body></html>