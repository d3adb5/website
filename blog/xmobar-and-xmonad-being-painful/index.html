<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is a story about how the Haskell toolset, Arch Linux package maintainers,
and font rendering engines made me lose a few hours of my life. Of course, I
consider myself equally guilty, for my choices and stubbornness inevitably led
to the happenings I am about to relay onto you.
Chapter 1: First Mistakes
It was a dark and stormy night somewhere in the world. I was sitting in front
of my laptop, speaking to a couple of friends over Mumble, when I accidentally
knocked over the glass of soda I&rsquo;d just fetched from the kitchen. It would
have been a minor inconvenience, had I not spilled it directly onto my
laptop. In a panic, I told my friends I&rsquo;d be back later and immediately shut
the system down to avoid any short circuits."><meta http-equiv=Content-Security-Policy content="default-src 'self' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src *; object-src 'none'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; worker-src 'self' blob:; base-uri 'self'"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Chronicles of XMonad and xmobar</title><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/source-sans-pro-600.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-regular.woff2 crossorigin><link rel=preload as=font type=font/woff2 href=/fonts/inconsolata-600.woff2 crossorigin><style type=text/css>@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:400;src:url(/fonts/source-sans-pro-regular.woff2)format("woff2"),url(/fonts/source-sans-pro-regular.woff)format("woff")}@font-face{font-display:swap;font-family:source sans pro;font-style:normal;font-weight:600;src:url(/fonts/source-sans-pro-600.woff2)format("woff2"),url(/fonts/source-sans-pro-600.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:400;src:url(/fonts/inconsolata-regular.woff2)format("woff2"),url(/fonts/inconsolata-regular.woff)format("woff")}@font-face{font-display:swap;font-family:inconsolata;font-style:normal;font-weight:600;src:url(/fonts/inconsolata-600.woff2)format("woff2"),url(/fonts/inconsolata-600.woff)format("woff")}footer#page-footer,nav#site-nav{background:0 0;padding:1em}footer#page-footer,nav#site-nav{background:#282a2e;color:#c5c8c6;line-height:3em}nav#site-nav{display:flex;overflow:auto;scrollbar-width:none}nav#site-nav::-webkit-scrollbar{display:none}nav#site-nav a{display:inline-block;width:6em;font-weight:700;text-align:center;color:inherit;flex-shrink:0}@media screen and (min-width:60em){footer#page-footer,nav#site-nav{line-height:inherit}}html{background:#252628}body{width:100%;max-width:60em;margin:0 auto;line-height:1.5em;font-family:source sans pro,helvetica,liberation sans,open sans,sans-serif;font-size:100%;color:#c5c8c6}@media screen and (min-width:60em){body{margin:2em auto!important}}h1,h2,h3,h4,h5,h6{margin:1.1em 0 .83em}h1,h2,h3{color:#8c9440}h4,h5,h6{color:#b5bd68}h1{font-size:1.5em}h2{font-size:1.26em}h3{font-size:1.1em}h4{font-size:1.03em}h5{font-size:.67em}h6{font-size:.51em}a{text-decoration:initial;color:#de935f}a:hover{text-decoration:underline}em{color:#f0c674;font-style:normal}strong{color:#c66}nav#site-nav{border-radius:1em 1em 0 0;background:0 0;color:#c5c8c6}nav#site-nav a.push-right{margin-left:auto}nav#site-nav a.current{color:#81a2be}label#toc-toggle{display:flex;width:100%;margin-top:1em;height:3em;align-items:center;justify-content:center}input#toc-toggle-box{display:none}input#toc-toggle-box~nav#TableOfContents{display:none}input#toc-toggle-box:checked~nav#TableOfContents{display:block}nav#TableOfContents{margin:.5em 0 0;box-sizing:border-box;background:#282a2e;padding:1em;border-radius:.5em;overflow:hidden;font-weight:700;color:#de935f}nav#TableOfContents ul{margin:0;padding:0;list-style-type:none}nav#TableOfContents ul li{overflow:hidden;white-space:nowrap;text-overflow:' ...'}nav#TableOfContents ul li+li{margin-top:1em}nav#TableOfContents ul ul{padding-left:1em;margin-top:1em}@media screen and (min-width:60em){nav#TableOfContents{float:right;margin:1em 0 1em 1em;max-width:40%;font-size:85%}nav#TableOfContents ul li+li{margin-top:initial}nav#TableOfContents ul ul{margin-top:initial}}@media screen and (min-width:60em){label#toc-toggle{display:none}}@media screen and (min-width:60em){input#toc-toggle-box~nav#TableOfContents{display:initial}}footer#page-footer{background:0 0;color:#707880;display:grid;grid-auto-flow:column;grid-template-columns:minmax(0,1fr)}footer#page-footer a{color:#f0c674}footer#page-footer span.commit-subject{color:#de935f;margin-left:.5em}footer#page-footer p#commit{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}footer#page-footer p#commit span.commit-hash{font-family:inconsolata,dejavu sans mono,liberation mono,monospace}footer#page-footer p#timestamp,footer#page-footer p#commit{margin:0}footer#page-footer p#timestamp{text-align:right}article{background:#1d1f21;padding:.1em 1.5em .8em}@media screen and (min-width:60em){article{border-radius:.5em}}article header{font-weight:700}article header section.header-line{display:flex;justify-content:space-between;align-items:center}article header section.header-line h1{color:#8c9440;margin-bottom:.25em}article header section.header-line aside#translations{margin:1.1em 0 .25em}article header section.header-line aside#translations ul#translations{list-style:none;padding:0;margin:0;display:flex;justify-content:space-around;font-size:115%}article header section.header-line aside#translations ul#translations li:not(:first-child){margin-left:1em}article header section.subheader-line{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}article header section.subheader-line p.subtitle{color:#5e8d87;margin:0}article header section.subheader-line p.subtitle em{color:inherit;font-style:italic}article header section.subheader-line ul#article-tags{list-style-type:none;padding-left:0;margin:0;font-size:85%}article header section.subheader-line ul#article-tags li{display:inline-block}article header section.subheader-line ul#article-tags li:nth-child(n+2){margin-left:1em}article header section.subheader-line ul#article-tags li a{color:#f0c674}article blockquote{color:#979a98;padding-left:1em;border:0 solid #707880;border-left-width:.5em}article table{width:100%}article table th{color:#81a2be}article table td{color:#c5c8c6}article table td.date{width:1%;white-space:nowrap;padding:0 .5em 0 0}article table.compare-table{border-collapse:collapse}article table.compare-table th,article table.compare-table td{padding:.5em 1em;box-sizing:border-box}article table.compare-table th:first-child,article table.compare-table td:first-child{padding-left:0}article table.compare-table th:last-child,article table.compare-table td:last-child{padding-right:0}article table.compare-table th,article table.compare-table td:nth-child(n+2){text-align:center}article table.compare-table td{border-top:.1em solid #707880}article table.compare-table th:nth-child(n+2){min-width:4em}article li::marker{color:#f0c674}article figure{margin:1.25em 0;text-align:center}article figure img{min-height:5em;max-height:15em;width:100%;object-fit:cover;border-radius:1em}article figure figcaption p{margin-top:0}article code{font-family:inconsolata,dejavu sans mono,liberation mono,monospace;font-size:100%}article pre{background:#282a2e;border-radius:.5em;padding:.5em 1em;overflow-x:auto;line-height:initial}article>hr{color:#707880;opacity:.5;margin:2em 0}article p code,article li code{background:#282a2e;padding:0 .3em;border-radius:.25em}article>p a,article>ul li a,article>ol li a{text-decoration:underline}article.extra-pages h2~p{margin-left:2em}article section.dialog{display:flex;padding:1em;align-content:center;border-radius:.5em;border:.2em solid #707880;margin:.5em 0 0;box-sizing:border-box;max-width:100%}article section.dialog p:first-child{margin-top:0}article section.dialog p:last-child{margin-bottom:0}article section.dialog .dialog-icon{margin-right:1em}article section.dialog.dialog-info{border-color:#5f819d}article section.dialog.dialog-warning{border-color:#de935f}article section.dialog.dialog-error{border-color:#a54242}article section.dialog.dialog-success{border-color:#8c9440}@media screen and (min-width:60em){article section.dialog{margin:1em 0 0}}</style></head><body><nav id=site-nav><a href=/ class=[]>Home
</a><a href=/blog/ class=[]>Blog
</a><a href=/glob/ class=[]>Glob
</a><a href=/projects/ class=[]>Projects
</a><a href=/about/ class=push-right>About</a></nav><main role=main><article id=content><header><section class=header-line><h1>Chronicles of XMonad and xmobar</h1></section><section class=subheader-line><p class=subtitle>The user, the status bar, and the window manager</p><ul id=article-tags><li><a href=/tags/ricing>Ricing</a></li><li><a href=/tags/haskell>Haskell</a></li><li><a href=/tags/xmonad>XMonad</a></li><li><a href=/tags/x11>X11</a></li><li><a href=/tags/xmobar>xmobar</a></li></ul></section></header><p>This is a story about how the Haskell toolset, Arch Linux package maintainers,
and font rendering engines made me lose a few hours of my life. Of course, I
consider myself equally guilty, for my choices and stubbornness inevitably led
to the happenings I am about to relay onto you.</p><h2 id=chapter-1-first-mistakes>Chapter 1: First Mistakes</h2><p>It was a dark and stormy night somewhere in the world. I was sitting in front
of my laptop, speaking to a couple of friends over Mumble, when I accidentally
<em>knocked over the glass of soda</em> I&rsquo;d just fetched from the kitchen. It would
have been a minor inconvenience, had I not <em>spilled it directly onto my
laptop.</em> In a panic, I told my friends I&rsquo;d be back later and immediately shut
the system down to avoid any short circuits.</p><p>Though I was able to clean up most of the mess, and properly avoided turning
the machine on in case there was still liquid inside, <em>the keyboard would
remain sticky for the rest of that laptop&rsquo;s life.</em> A keyboard replacement cost
too much money to justify the purchase, and I was due for an upgrade anyway.</p><p>When I got a new laptop, I decided this time around I wasn&rsquo;t going to waste
time customizing Windows. Instead I&rsquo;d make the <em>switch to GNU/Linux
completely,</em> and use all the cool tools I&rsquo;d heard being talked about on IRC for
years. Rather than ask anybody what I should use, <em>I went with a Debian
netinst,</em> and used the only window manager the name of which I could remember:
<strong>XMonad.</strong></p><h2 id=chapter-2-growing-pains>Chapter 2: Growing Pains</h2><p><em>XMonad is a great window manager for the Haskell programmer.</em> In a way it
isn&rsquo;t a window manager unto itself, but rather a library for building your own
window manager in Haskell, with the configuration data type containing
functions for hooks that allow you to alter window managing behavior. Should
you ever wish to fully control how your windows are managed on X11, and you&rsquo;re
either <em>a Haskell programmer or someone who truly wishes to become one,</em> I
highly recommend XMonad.</p><p>You see, <em>I didn&rsquo;t fit into either of those categories</em> when I started using
it, and for a couple months I was completely oblivious to the fact I was using
a programming language, not what I imagined to be XMonad&rsquo;s configuration
syntax. When I realized what it was, I was amazed, but at the same time
completely lost: I didn&rsquo;t know Haskell, and I had never come across functional
programming.</p><p>At some point, I decided <em>I was going to learn it,</em> and fell in love with the
language. It allowed me to make my window manager do exactly what I wanted,
provided I could figure out its internal machinations. Erstwhile an advocate of
C as an end all be all language due to its simplicity, I might&rsquo;ve abandoned
XMonad altogether had I been introduced to <code>dwm</code> sooner.</p><p>It was during this time of learning more about XMonad, window managers, and
Haskell that I found xmobar. It&rsquo;s an uncomplicated program that serves as a
status bar. Since it&rsquo;s written &mdash; and can be extended &mdash; in Haskell, it&rsquo;s a
common option for XMonad users.</p><p>My &ldquo;Haskell studies&rdquo; went well enough I was soon making changes to the modules
on the <code>xmonad-contrib</code> package. Some of those changes were submitted and even
merged upstream! Locally I started using <code>xmonad-git</code> and <code>xmonad-contrib-git</code>:
packages in the AUR that build the latest version of these two packages from
the <code>master</code> branch of their respective repositories. I just needed to point
them to my local work trees for testing.</p><h2 id=chapter-3-arch-linux-and-the-winds-of-progress>Chapter 3: Arch Linux and the Winds of Progress</h2><p>One day I boot up my laptop as usual and try to <code>startx</code>, only to get a
mysterious error about missing shared library files. Recompilation of my XMonad
configuration wasn&rsquo;t working, as I knew how to do it only through <code>xmonad --recompile</code>, and the <code>xmonad</code> binary was giving me the same linker error. I
turned to the <code>#xmonad</code> channel on IRC, then on Freenode. Turns out I wasn&rsquo;t
the only one that day inquiring about the same error messages!</p><p>Turns out the maintainers of Haskell packages on Arch Linux got tired of using
up obnoxious amounts of disk space by shipping static library files. At some
point they decided from GHC to Pandoc and XMonad, <em>every Haskell binary would
be dynamically linked</em> against its dependencies, and every library package
would ship only the <code>.so</code> shared object files.</p><p>I shall take no part in the debate about whether dynamic linking is worse or
better than static linking. However, <em>Haskell makes dynamic linking a little&mldr;
problematic.</em> When packages are registered with GHC, their library files get
this seemingly random string of characters just before the <code>.so</code> extension &mdash;
e.g. <code>libHSlibyaml-0.1.2-EKt9DNz2mMV6vcYqiiizdE-ghc9.0.2.so</code>. Maybe this is
done to ensure a specific build, or maybe it&rsquo;s just a way to make sure the GHC
ABI is what you&rsquo;d expect. Whatever it is, <em>I don&rsquo;t like it.</em></p><p>The reason XMonad broke for so many users at the same time was because the
binary was dynamically linked against files that were no longer present: the
<code>haskell-*</code> packages that it depends on were updated, receiving completely new
set of random characters at the end, but the <code>xmonad</code> binary hadn&rsquo;t yet been
linked against them and pushed to the official repositories. <em>This was
resolved</em> and now packages like <code>xmonad</code> are properly rebuilt on a timely
manner. However, <em>I said I started using <code>xmonad-git</code>!</em> Rebuilding the package
then became my responsibility, and whenever dependencies were updated, XMonad
would stop working and I&rsquo;d have to rebuild the whole package.</p><p>Eventually I started using Stack. It&rsquo;s a tool for managing GHC installations
and Haskell projects, and it&rsquo;s one of the choices to pick from when installing
XMonad. My XMonad configuration became a Stack package and <em>it just worked!</em> I
could abandon the <code>xmonad</code> package from the official repositories and instead
rely on Stack to make a symlink in my <code>~/.local/bin</code> directory. By default,
everything was statically linked.</p><h2 id=chapter-4-font-rendering>Chapter 4: Font Rendering</h2><p>Though I jumped off the Pacman train for XMonad, I had no reason to switch away
from the official package for my status bar, xmobar. It worked fine, with
linker errors seldom occurring. However, just a few days ago, the official
package was updated to version <code>0.46.0</code>, which brought with it the switch from
Xft to Pango as the font rendering engine &mdash; a change merged upstream in
version <code>0.45.0</code>, previously not packaged. <em>Obviously, that couldn&rsquo;t have been
transparent.</em></p><p>No matter what font size I tried using, <em>DejaVu Sans Mono</em> looked off, either
blurry or too big, completely different from how it looks on my terminal
emulator. Downgrading the package doesn&rsquo;t fix the issue, because then <em>you have
to downgrade all of its dependencies as well</em> because of the dynamic linking
issue. If any of those dependencies are used by other packages, you&rsquo;ll have to
downgrade those as well. It&rsquo;s a mess.</p><p>So instead I went with <code>stack install xmobar-0.44.2</code> and called it a day. For
now I&rsquo;m staying on that version, willing to backport bug fixes from upstream if
necessary. There&rsquo;s mention of <a href=https://codeberg.org/xmobar/xmobar/issues/658>pangoxft</a> in an issue opened on the
xmobar issue tracker, so maybe there <em>is</em> an upgrade path for me!</p><h2 id=chapter-5-the-future>Chapter 5: The Future</h2><p>For the time being, using Stack to manage my Haskell projects is working out
okay, but I might switch to a distribution that still ships static library
files in their Haskell packages. Maybe Nix? Not sure.</p></article></main><footer id=page-footer><p id=commit><a href=https://github.com/d3adb5/website/commit/538f1828a225229364fac663e3a9549e8db8e1d9><span class=commit-hash>538f182</span><span class=commit-subject>feat: add tags to existing blog posts</span></a></p><p id=timestamp>Updated May 14, 2023</p></footer></body></html>